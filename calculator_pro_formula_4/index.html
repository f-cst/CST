<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator Pro Formula 4</title>
    <style>
        /* ØªÙ…Ø§Ù… Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ CSS Ø´Ù…Ø§ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ Ø§Ø³Øª */
        :root {
            --bg-color: #f5f5f5;
            --container-bg: white;
            --text-color: #333;
            --input-border: #ddd;
            --button-primary: #3498db;
            --button-primary-hover: #2980b9;
            --button-secondary: #e74c3c;
            --button-secondary-hover: #c0392b;
            --button-success: #27ae60;
            --button-success-hover: #219a52;
            --result-bg: #f8f9fa;
            --error-color: #e74c3c;
            --error-bg: #fadbd8;
            --success-color: #27ae60;
            --success-bg: #d5f4e6;
            --header-color: #2c3e50;
            --table-header: #34495e;
            --table-row-even: #f8f9fa;
            --table-row-hover: #e3f2fd;
            --menu-bg: #ffffff;
            --menu-border: #e0e0e0;
            --category-bg: #e8f4fd;
            --category-border: #3498db;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        .dark-mode {
            --bg-color: #1a1a1a;
            --container-bg: #2d2d2d;
            --text-color: #f0f0f0;
            --input-border: #555;
            --button-primary: #2980b9;
            --button-primary-hover: #3498db;
            --button-secondary: #c0392b;
            --button-secondary-hover: #e74c3c;
            --button-success: #27ae60;
            --button-success-hover: #219a52;
            --result-bg: #3d3d3d;
            --error-color: #ff6b6b;
            --error-bg: #4a2a2a;
            --success-color: #2ecc71;
            --success-bg: #1e3a2e;
            --header-color: #70a1ff;
            --table-header: #404040;
            --table-row-even: #3d3d3d;
            --table-row-hover: #4a4a4a;
            --menu-bg: #3d3d3d;
            --menu-border: #555;
            --category-bg: #2a4d6e;
            --category-border: #3498db;
        }
        * {
            box-sizing: border-box;
        }
        body {
            font-family: Tahoma, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            position: relative;
            min-height: 60px;
            /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ø¨Ø±Ø§ÛŒ Ù‡Ø¯Ø± */
        }
        h1, h2, h3 {
            color: var(--header-color);
            margin: 0 0 15px 0;
        }
        .theme-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            transition: transform 0.3s ease;
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 101; /* Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ */
        }
        .theme-toggle:hover {
            transform: translateY(-50%) scale(1.1);
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØ¨â€ŒÙ‡Ø§ - Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--input-border);
            overflow-x: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--button-primary) var(--bg-color);
            padding-bottom: 5px;
            cursor: grab;
        }
        .tabs::-webkit-scrollbar {
            height: 8px;
        }
        .tabs::-webkit-scrollbar-track {
            background: var(--bg-color);
            border-radius: 4px;
        }
        .tabs::-webkit-scrollbar-thumb {
            background: var(--button-primary);
            border-radius: 4px;
        }
        .tabs::-webkit-scrollbar-thumb:hover {
            background: var(--button-primary-hover);
        }
        .tabs:active {
            cursor: grabbing;
        }
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
            position: relative;
        }
        .tab.active {
            background-color: var(--button-primary);
            color: white;
        }
        .tab:hover:not(.active) {
            background-color: var(--result-bg);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ - Ú©Ø§Ù…Ù„Ø§Ù‹ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ */
        .mobile-menu-toggle {
            display: none;
            flex-direction: column;
            justify-content: space-around;
            width: 2.5rem;
            height: 2.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
        }
        .mobile-menu-toggle span {
            display: block;
            width: 2.5rem;
            height: 3px;
            background-color: var(--text-color);
            border-radius: 10px;
            transition: all 0.3s linear;
            position: relative;
            transform-origin: 1px;
        }
        .mobile-menu-toggle.active span:nth-child(1) {
            transform: rotate(45deg);
        }
        .mobile-menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }
        .mobile-menu-toggle.active span:nth-child(3) {
            transform: rotate(-45deg);
        }
        .mobile-menu-toggle:hover {
            background-color: transparent !important;
        }
        .mobile-menu-toggle:active,
        .mobile-menu-toggle:focus {
            background-color: transparent !important;
            outline: none;
            border: none !important;
            box-shadow: none !important;
        }
        .mobile-tabs {
            display: none;
            flex-direction: column;
            margin-bottom: 20px;
            background-color: var(--menu-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid var(--menu-border);
        }
        .mobile-tab {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--input-border);
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
        }
        .mobile-tab:last-child {
            border-bottom: none;
        }
        .mobile-tab.active {
            background-color: var(--button-primary);
            color: white;
        }
        .mobile-tab:hover:not(.active) {
            background-color: var(--result-bg);
        }
        .input-group {
            margin-bottom: 20px;
        }
        .input-row {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
            flex-wrap: wrap;
        }
        .input-container {
            flex: 1;
            padding: 0 10px;
            min-width: 200px;
        }
        .results-container {
            flex: 1;
            padding: 0 10px;
            min-width: 200px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="date"], input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--input-border);
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
            background-color: var(--container-bg);
            color: var(--text-color);
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--button-primary);
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 20px;
            background-color: var(--button-primary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: var(--button-primary-hover);
        }
        button.success {
            background-color: var(--button-success);
        }
        button.success:hover {
            background-color: var(--button-success-hover);
        }
        button.danger {
            background-color: var(--button-secondary);
        }
        button.danger:hover {
            background-color: var(--button-secondary-hover);
        }
        #resetBtn {
            background-color: var(--button-secondary);
        }
        #resetBtn:hover {
            background-color: var(--button-secondary-hover);
        }
        .result {
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
            background-color: var(--result-bg);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--input-border);
        }
        .result:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: var(--button-primary);
        }
        .result:active {
            transform: translateY(0);
        }
        .result.copied::after {
            content: "Ú©Ù¾ÛŒ Ø´Ø¯!";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(46, 204, 113, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            animation: fadeOut 1.5s forwards;
        }
        .table-cell {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .table-cell:hover {
            background-color: var(--table-row-hover);
            transform: translateY(-1px);
        }
        .table-cell.copied {
            background-color: var(--success-bg) !important;
            color: var(--success-color) !important;
        }
        .card-value {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .card-value:hover {
            background-color: var(--button-primary);
            color: white;
        }
        .card-value.copied {
            background-color: var(--success-bg) !important;
            color: var(--success-color) !important;
        }
        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }
        .below-low {
            color: var(--error-color);
            background-color: var(--error-bg);
        }
        .above-high {
            color: var(--success-color);
            background-color: var(--success-bg);
        }
        .error {
            color: var(--error-color);
            background-color: var(--error-bg);
        }
        .instructions {
            margin-top: 20px;
            padding: 10px;
            background-color: var(--result-bg);
            border-radius: 4px;
            font-size: 14px;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾ - Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ */
        .table-container {
            overflow-x: auto;
            overflow-y: auto; /* ØªØºÛŒÛŒØ± Ø§Ø² hidden Ø¨Ù‡ auto Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¹Ù…ÙˆØ¯ÛŒ */
            max-height: 60vh;
            /* Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¹Ù…ÙˆØ¯ÛŒ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² */
            margin: 20px 0;
            cursor: grab;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--button-primary) var(--bg-color);
            padding-bottom: 5px;
        }
        .table-container::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .table-container::-webkit-scrollbar-track {
            background: var(--bg-color);
            border-radius: 4px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: var(--button-primary);
            border-radius: 4px;
        }
        .table-container::-webkit-scrollbar-thumb:hover {
            background: var(--button-primary-hover);
        }
        .table-container:active {
            cursor: grabbing;
        }
        table {
            width: 200%;
            /* Ø§ÙØ²Ø§ÛŒØ´ Ø¹Ø±Ø¶ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙÙ‚ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ */
            border-collapse: collapse;
            margin: 10px 0;
            min-width: 1200px; /* Ø­Ø¯Ø§Ù‚Ù„ Ø¹Ø±Ø¶ Ø¨Ø±Ø§ÛŒ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ§Ø¯ */
        }
        th, td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid var(--input-border);
            white-space: nowrap;
            user-select: text;
            /* ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ù…ØªÙ† */
        }
        th {
            background-color: var(--table-header);
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        tr:nth-child(even) {
            background-color: var(--table-row-even);
        }
        tr:hover {
            background-color: var(--table-row-hover);
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        .action-btn {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 3px;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Øª Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        .mobile-cards-container {
            display: none;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        .calculation-card {
            background-color: var(--result-bg);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--input-border);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--input-border);
        }
        .card-date {
            font-weight: bold;
            color: var(--header-color);
        }
        .card-currency {
            background-color: var(--button-primary);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .card-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .card-item {
            display: flex;
            flex-direction: column;
        }
        .card-label {
            font-size: 12px;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 3px;
        }
        .card-value {
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s ease;
            padding: 4px;
            border-radius: 3px;
        }
        .card-actions {
            margin-top: 10px;
            display: flex;
            justify-content: flex-end;
            gap: 5px;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙØª Ø§Ø±Ø² - Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ */
        .category-section {
            margin: 8px 0;
            padding: 12px;
            background-color: var(--category-bg);
            border-radius: 8px;
            border: 1px solid var(--category-border);
            transition: all 0.3s ease;
        }
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px 12px;
            background-color: var(--container-bg);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--input-border);
        }
        .category-header:hover {
            background-color: var(--result-bg);
        }
        .category-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--header-color);
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .category-title::before {
            content: "ğŸ“";
            font-size: 14px;
        }
        .category-actions {
            display: flex;
            gap: 6px;
            flex-wrap: nowrap;
        }
        .category-actions button {
            padding: 6px 8px;
            min-width: auto;
            font-size: 14px;
        }
        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
        }
        .edit-icon {
            background-color: var(--button-primary);
            color: white;
        }
        .edit-icon:hover {
            background-color: var(--button-primary-hover);
        }
        .delete-icon {
            background-color: var(--button-secondary);
            color: white;
        }
        .delete-icon:hover {
            background-color: var(--button-secondary-hover);
        }
        .category-pairs {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-top: 8px;
            transition: all 0.3s ease;
        }
        .category-pairs.collapsed {
            display: none;
        }
        .currency-pair-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            margin: 1px 0;
            background-color: var(--result-bg);
            border-radius: 4px;
            border: 1px solid var(--input-border);
            transition: all 0.3s ease;
            min-height: 36px;
            cursor: grab;
        }
        .currency-pair-item:hover {
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }
        .currency-pair-item:active {
            cursor: grabbing;
        }
        .currency-pair-item.dragging {
            opacity: 0.5;
            background-color: var(--button-primary);
            color: white;
        }
        .currency-pair-item.drag-over {
            border: 2px dashed var(--button-primary);
            background-color: rgba(52, 152, 219, 0.1);
        }
        .currency-pair-name {
            font-size: 14px;
            font-weight: 500;
            flex: 1;
            text-align: right;
            padding-left: 8px;
        }
        .currency-pair-actions {
            display: flex;
            gap: 4px;
            align-items: center;
            flex-wrap: nowrap;
        }
        .move-buttons {
            display: flex;
            gap: 2px;
            margin-left: 6px;
        }
        .move-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 3px 5px;
            font-size: 11px;
            color: var(--text-color);
            opacity: 0.7;
            transition: all 0.2s ease;
            min-width: 24px;
            border-radius: 3px;
        }
        .move-btn:hover {
            opacity: 1;
            background-color: var(--button-primary);
            color: white;
        }
        .move-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background-color: transparent;
            color: var(--text-color);
        }
        .edit-currency-pair {
            background-color: var(--button-primary);
        }
        .edit-currency-pair:hover {
            background-color: var(--button-primary-hover);
        }
        .delete-currency-pair {
            background-color: var(--button-secondary);
        }
        .delete-currency-pair:hover {
            background-color: var(--button-secondary-hover);
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡ - Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ */
        .comparison-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison-item {
            flex: 1;
            min-width: 300px;
            padding: 15px;
            background-color: var(--result-bg);
            border-radius: 5px;
            border: 1px solid var(--input-border);
        }
        .comparison-dates-container {
            margin: 15px 0;
        }
        .comparison-date-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .comparison-date-input {
            flex: 1;
        }
        .remove-date-btn {
            background-color: var(--button-secondary);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 8px 12px;
            font-size: 14px;
        }
        .remove-date-btn:hover {
            background-color: var(--button-secondary-hover);
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1100;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }
        .form-group {
            margin-bottom: 15px;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø¹Ù„Ø§Ù† */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 20px;
            background-color: var(--button-success);
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1200;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
            animation: slideDown 0.3s ease;
        }
        .notification.error {
            background-color: var(--error-color);
        }
        .notification.warning {
            background-color: #f39c12;
        }
        @keyframes slideDown {
            from {
                top: -100px;
                opacity: 0;
            }
            to {
                top: 20px;
                opacity: 1;
            }
        }
        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
            margin-right: auto;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ */
        .filter-container {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .filter-item {
            flex: 1;
            min-width: 150px;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            .header {
                flex-direction: row;
                align-items: center;
                padding-left: 45px; /* Ú©Ø§Ù‡Ø´ ÙØ§ØµÙ„Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ ØªØ§Ø±ÛŒÚ©/Ø±ÙˆØ´Ù† */
                padding-right: 45px;
                /* Ú©Ø§Ù‡Ø´ ÙØ§ØµÙ„Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ */
                min-height: 50px;
                /* Ø§Ø±ØªÙØ§Ø¹ Ú©Ù…ØªØ± Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
            }
            .input-row {
                flex-direction: column;
            }
            .input-container, .results-container {
                width: 100%;
                padding: 0;
                margin-bottom: 10px;
            }
            .button-group {
                flex-direction: column;
            }
            .button-group button {
                width: 100%;
            }
            .filter-container {
                flex-direction: column;
            }
            .filter-item {
                width: 100%;
            }
            /* Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ Ùˆ Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¬Ø¯ÙˆÙ„ */
            .table-container {
                display: none;
            }
            .mobile-cards-container {
                display: flex;
            }
            .comparison-item {
                min-width: 100%;
            }
            h1 {
                font-size: 18px;
                /* Ú©Ø§Ù‡Ø´ Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
                text-align: center;
                flex: 1;
                margin: 0 5px;
                padding: 0 10px;
                line-height: 1.2;
            }
            .tabs {
                display: none;
                cursor: default;
            }
            .mobile-menu-toggle {
                display: flex;
            }
            .mobile-tabs {
                display: none;
            }
            /* Ø¨Ù‡Ø¨ÙˆØ¯ Ù†Ù…Ø§ÛŒØ´ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
            .category-section {
                padding: 10px;
                margin: 6px 0;
            }
            .category-header {
                padding: 6px 10px;
                flex-direction: row;
                align-items: center;
                gap: 8px;
            }
            .category-actions {
                justify-content: flex-end;
            }
            .currency-pair-item {
                padding: 5px 6px;
                flex-direction: row;
                align-items: center;
                gap: 4px;
                min-height: 32px;
                cursor: default;
            }
            .currency-pair-name {
                font-size: 12px;
                padding-left: 4px;
            }
            .currency-pair-actions {
                flex-direction: row;
                gap: 2px;
            }
            .action-btn {
                padding: 3px 6px;
                font-size: 10px;
                min-width: 40px;
            }
            .move-buttons {
                margin-left: 4px;
                gap: 1px;
            }
            .move-btn {
                padding: 2px 3px;
                font-size: 9px;
                min-width: 20px;
            }
            .icon-btn {
                padding: 5px 6px;
                min-width: 28px;
                font-size: 12px;
            }
            /* Ú†ÛŒØ¯Ù…Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¯Ø± ØªØ¨ Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ */
            .mobile-input-order {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            .desktop-input-order {
                display: none;
            }
            /* ØªÙ†Ø¸ÛŒÙ… Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ú©Ù…Ù‡ ØªØ§Ø±ÛŒÚ©/Ø±ÙˆØ´Ù† Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„ */
            .theme-toggle {
                left: 0;
                /* Ú†Ø³Ø¨Ø§Ù†Ø¯Ù† Ø¨Ù‡ Ù„Ø¨Ù‡ */
                padding: 8px 10px;
            }
        }
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            .modal-content {
                padding: 15px;
                width: 95%;
            }
            .card-content {
                grid-template-columns: 1fr;
            }
            .action-buttons {
                flex-direction: column;
            }
            .header {
                padding-left: 40px;
                padding-right: 40px;
                min-height: 45px;
            }
            h1 {
                font-size: 16px;
                /* Ú©Ø§Ù‡Ø´ Ø¨ÛŒØ´ØªØ± Ø³Ø§ÛŒØ² ÙÙˆÙ†Øª */
                margin: 0 2px;
                padding: 0 5px;
            }
            /* Ø¨Ù‡Ø¨ÙˆØ¯ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©ÙˆÚ†Ú© */
            .currency-pair-item {
                padding: 4px 5px;
            }
            .currency-pair-name {
                font-size: 11px;
            }
            .action-btn {
                padding: 2px 4px;
                font-size: 9px;
                min-width: 35px;
            }
            .move-btn {
                padding: 1px 2px;
                font-size: 8px;
                min-width: 18px;
            }
            .mobile-menu-toggle {
                width: 2rem;
                height: 2rem;
            }
            .mobile-menu-toggle span {
                width: 2rem;
            }
            .theme-toggle {
                font-size: 20px;
                /* Ú©Ø§Ù‡Ø´ Ø³Ø§ÛŒØ² Ø¢ÛŒÚ©ÙˆÙ† */
                padding: 6px 8px;
            }
        }
        /* Ù†Ù…Ø§ÛŒØ´ Ù‡Ø± Ø¯Ùˆ Ø­Ø§Ù„Øª Ø¯Ø± Ø¯Ø³Ú©ØªØ§Ù¾ */
        @media (min-width: 769px) {
            .mobile-cards-container {
                display: none !important;
            }
            .table-container {
                display: block !important;
                cursor: grab;
            }
            .mobile-menu-toggle,
            .mobile-tabs {
                display: none !important;
            }
            .tabs {
                display: flex !important;
                cursor: grab;
            }
            .currency-pair-name {
                font-size: 16px;
            }
            .mobile-input-order {
                display: none !important;
            }
            .desktop-input-order {
                display: grid !important;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
            }
            .desktop-input-order .input-container:nth-child(1) {
                grid-column: 1;
                grid-row: 1;
            }
            .desktop-input-order .input-container:nth-child(2) {
                grid-column: 2;
                grid-row: 1;
            }
            .desktop-input-order .input-container:nth-child(3) {
                grid-column: 1;
                grid-row: 2;
            }
            .desktop-input-order .input-container:nth-child(4) {
                grid-column: 2;
                grid-row: 2;
            }
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ */
        .delete-options {
            margin: 15px 0;
            padding: 15px;
            background-color: var(--result-bg);
            border-radius: 5px;
            border: 1px solid var(--input-border);
        }
        .delete-option {
            margin: 10px 0;
        }
        .delete-option label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: normal;
        }
        .delete-option input[type="radio"] {
            width: auto;
            margin: 0;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    .signature {
        text-align: center;
        padding: 16px;
        font-family: Vazirmatn, system-ui;
        border-radius: 10px;
        backdrop-filter: blur(5px);
        font-size: 14px;
        font-weight: 500;
        display: block;
        margin: 30px auto;
        width: fit-content;
        max-width: 90%;
        box-sizing: border-box;
        transition: all 0.3s ease;
        border: 1px solid rgba(0, 0, 0, 0.1);
        background: rgba(0, 0, 0, 0.05);
        color: #666;
    }
    .dark-mode .signature {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
@media only screen and (max-width: 768px) {
    .signature {
        font-size: 14px;
        padding: 15px;
    }
}
@media only screen and (max-width: 480px) {
    .signature {
        font-size: 12px;
        padding: 13px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Ù…Ù†Ùˆ">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <h1>Calculator Pro Formula 4</h1>
            <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>
        </div>
                       <HR>
        <BR>
        <div class="mobile-tabs" id="mobileTabs">
            <div class="mobile-tab active" data-tab="calculator">Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨</div>
            <div class="mobile-tab" data-tab="history">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª</div>
            <div class="mobile-tab" data-tab="comparison">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</div>
            <div class="mobile-tab" data-tab="currency-pairs">Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§</div>
            <div class="mobile-tab" data-tab="backup">Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</div>
            <div class="mobile-tab" data-tab="delete-records">Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯</div>
        </div>
        <div class="tabs" id="tabs">
            <div class="tab active" data-tab="calculator">Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨</div>
            <div class="tab" data-tab="history">ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª</div>
            <div class="tab" data-tab="comparison">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</div>
            <div class="tab" data-tab="currency-pairs">Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§</div>
            <div class="tab" data-tab="backup">Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</div>
            <div class="tab" data-tab="delete-records">Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯</div>
        </div>
        <div class="tab-content active" id="calculator-tab">
            <h2>Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ±Ù…ÙˆÙ„â€ŒÙ‡Ø§</h2>
            <div class="form-group">
                <label for="currencyPairSelect">Ø¬ÙØª Ø§Ø±Ø²:</label>
                <select id="currencyPairSelect">
                    <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ø¬ÙØª Ø§Ø±Ø² --</option>
                </select>
            </div>
            <div class="form-group">
                <label for="calculationDate">ØªØ§Ø±ÛŒØ® Ù…Ø­Ø§Ø³Ø¨Ù‡:</label>
                <input type="date" id="calculationDate">
            </div>
            <div class="input-group">
                <div class="input-row desktop-input-order">
                    <div class="input-container">
                        <label for="input_y1">Ø¹Ø¯Ø¯ Ø³Ù‚Ù:</label>
                        <input type="text" id="input_y1" placeholder="Ø¹Ø¯Ø¯ Ø³Ù‚Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                    <div class="input-container">
                        <label for="input_current_high">Ø¹Ø¯Ø¯ ÙØ¹Ù„ÛŒ Ø³Ù‚Ù:</label>
                        <input type="text" id="input_current_high" placeholder="Ø¹Ø¯Ø¯ ÙØ¹Ù„ÛŒ Ø³Ù‚Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                    <div class="input-container">
                        <label for="input_y2">Ø¹Ø¯Ø¯ Ú©Ù:</label>
                        <input type="text" id="input_y2" placeholder="Ø¹Ø¯Ø¯ Ú©Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                    <div class="input-container">
                        <label for="input_current_low">Ø¹Ø¯Ø¯ ÙØ¹Ù„ÛŒ Ú©Ù:</label>
                        <input type="text" id="input_current_low" placeholder="Ø¹Ø¯Ø¯ ÙØ¹Ù„ÛŒ Ú©Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                </div>
                <div class="input-row mobile-input-order">
                    <div class="input-container">
                        <label for="input_y1_mobile">Ø¹Ø¯Ø¯ Ø³Ù‚Ù:</label>
                        <input type="text" id="input_y1_mobile" placeholder="Ø¹Ø¯Ø¯ Ø³Ù‚Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                    <div class="input-container">
                        <label for="input_y2_mobile">Ø¹Ø¯Ø¯ Ú©Ù:</label>
                        <input type="text" id="input_y2_mobile" placeholder="Ø¹Ø¯Ø¯ Ú©Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                    <div class="input-container">
                        <label for="input_current_high_mobile">Ø¹Ø¯Ø¯ ÙØ¹Ù„ÛŒ Ø³Ù‚Ù:</label>
                        <input type="text" id="input_current_high_mobile" placeholder="Ø¹Ø¯Ø¯ ÙØ¹Ù„ÛŒ Ø³Ù‚Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                    <div class="input-container">
                        <label for="input_current_low_mobile">Ø¹Ø¯Ø¯ ÙØ¹Ù„ÛŒ Ú©Ù:</label>
                        <input type="text" id="input_current_low_mobile" placeholder="Ø¹Ø¯Ø¯ ÙØ¹Ù„ÛŒ Ú©Ù Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                    </div>
                </div>
            </div>
            <div class="button-group">
                <button id="calculateBtn">Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø°Ø®ÛŒØ±Ù‡</button>
                <button id="resetBtn">Ø±ÛŒØ³Øª</button>
            </div>
            <div class="results-grid" id="results_list">
                </div>
            <div id="error_message" class="error" style="display: none;
 margin-top: 10px; padding: 10px; border-radius: 4px;"></div>
            <div class="instructions">
                <p><strong>Ø±Ø§Ù‡Ù†Ù…Ø§:</strong></p>
                <ul>
                    <li>Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù†ØªÛŒØ¬Ù‡ØŒ Ø±ÙˆÛŒ Ø¢Ù† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</li>
                    <li>Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©/Ø±ÙˆØ´Ù†ØŒ Ø±ÙˆÛŒ Ø¢ÛŒÚ©ÙˆÙ† Ù…Ø§Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</li>
                    <li>Ø­ØªÙ…Ø§Ù‹ Ø¬ÙØª Ø§Ø±Ø² Ùˆ ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ø¯Ø§Ø¯Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´ÙˆØ¯</li>
                    <li>Ù†ØªØ§ÛŒØ¬ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø§Ø² Ú©ÙˆÚ†Ú© Ø¨Ù‡ Ø¨Ø²Ø±Ú¯ Ù…Ø±ØªØ¨ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯</li>
                    <li><span style="color: var(--error-color);">Ù‚Ø±Ù…Ø²: Ø²ÛŒØ± Ú©Ù ÙØ¹Ù„ÛŒ</span> - <span style="color: var(--success-color);">Ø³Ø¨Ø²: Ø¨Ø§Ù„Ø§ÛŒ Ø³Ù‚Ù ÙØ¹Ù„ÛŒ</span></li>
                </ul>
            </div>
        </div>
        <div class="tab-content" id="history-tab">
            <h2>ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª</h2>
            <div class="filter-container">
                <div class="filter-item">
                    <label for="filterCurrencyPair">Ø¬ÙØª Ø§Ø±Ø²:</label>
                    <select id="filterCurrencyPair">
                        <option value="">Ù‡Ù…Ù‡ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label for="filterDate">ØªØ§Ø±ÛŒØ®:</label>
                    <input type="date" id="filterDate">
                </div>
            </div>
            <div class="table-container">
                <table id="calculationsTable">
                    <thead>
                        <tr>
                            <th>ØªØ§Ø±ÛŒØ®</th>
                            <th>Ø¬ÙØª Ø§Ø±Ø²</th>
                            <th>Ø¹Ø¯Ø¯ Ø³Ù‚Ù</th>
                            <th>Ø¹Ø¯Ø¯ Ú©Ù</th>
                            <th>Ø³Ù‚Ù ÙØ¹Ù„ÛŒ</th>
                            <th>Ú©Ù ÙØ¹Ù„ÛŒ</th>
                            <th>ÙØ±Ù…ÙˆÙ„ Û±</th>
                            <th>ÙØ±Ù…ÙˆÙ„ Û²</th>
                            <th>ÙØ±Ù…ÙˆÙ„ Û³</th>
                            <th>ÙØ±Ù…ÙˆÙ„ Û´</th>
                            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="calculationsTableBody">
                        </tbody>
                </table>
            </div>
            <div class="mobile-cards-container" id="mobileCardsContainer">
                </div>
            <div id="noDataMessage" style="text-align: center;
 padding: 20px; display: none;">
                Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.
            </div>
        </div>
        <div class="tab-content" id="comparison-tab">
            <h2>Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h2>
            <div class="form-group">
                <label for="comparisonCurrencyPair">Ø¬ÙØª Ø§Ø±Ø² Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡:</label>
                <select id="comparisonCurrencyPair">
                    <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ø¬ÙØª Ø§Ø±Ø² --</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡:</label>
                <div id="comparisonDatesContainer" class="comparison-dates-container">
                    <div class="comparison-date-row">
                        <div class="comparison-date-input">
                            <input type="date" class="comparison-date">
                        </div>
                        <button type="button" class="remove-date-btn" style="display: none;">Ã—</button>
                    </div>
                </div>
                <button type="button" id="addDateBtn" class="success">+ Ø§ÙØ²ÙˆØ¯Ù† ØªØ§Ø±ÛŒØ®</button>
            </div>
            <div class="button-group">
                <button id="compareDataBtn">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
                <button id="clearComparisonBtn" class="danger">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
            </div>
            <div id="comparisonResults" class="comparison-container">
                </div>
        </div>
        <div class="tab-content" id="currency-pairs-tab">
            <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ Ùˆ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</h2>
            <BR>
            <div class="form-group">
                <h3><li>Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯</li></h3>
                <label for="newCategoryName">Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</label>
                <input type="text" id="newCategoryName" placeholder="Ù…Ø«Ù„Ø§Ù‹: ÙØ§Ø±Ú©Ø³ØŒ Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„">
                <button id="addCategoryBtn" class="success" style="margin-top: 5px;">Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</button>
            </div>
            <div class="form-group">
                <h3><li>Ø§ÙØ²ÙˆØ¯Ù† Ø¬ÙØª Ø§Ø±Ø² Ø¬Ø¯ÛŒØ¯</li></h3>
                <label for="newCurrencyPair">Ø¬ÙØª Ø§Ø±Ø² Ø¬Ø¯ÛŒØ¯:</label>
                <input type="text" id="newCurrencyPair" placeholder="Ù…Ø«Ù„Ø§Ù‹: EUR/USD">
            </div>
            <div class="form-group">
                <label for="currencyPairCategory">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</label>
                <select id="currencyPairCategory">
                    <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ --</option>
                </select>
            </div>
            <div class="button-group">
                <button id="addCurrencyPairBtn" class="success">Ø§ÙØ²ÙˆØ¯Ù† Ø¬ÙØª Ø§Ø±Ø²</button>
            </div>
            <BR>
            <h3><li>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ Ùˆ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯</li></h3>
            <div id="currencyPairsList">
                </div>
        </div>
        <div class="tab-content" id="backup-tab">
            <h2>Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</h2>
            <div class="instructions">
                <p>Ø§Ø² Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ú¯ÛŒØ±ÛŒØ¯ ÛŒØ§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†ÛŒØ¯.</p>
            </div>
            <div class="button-group">
                <button id="backupDataBtn" class="success">Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
                <button id="restoreDataBtn">Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
            </div>
            <input type="file" id="restoreFileInput" accept=".json" style="display: none;">
            <div class="instructions" style="margin-top: 20px;">
                <p><strong>ØªÙˆØ¬Ù‡:</strong> ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø´Ø§Ù…Ù„ ØªÙ…Ø§Ù… Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ØŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ùˆ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø´Ù…Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯.</p>
            </div>
        </div>
        <div class="tab-content" id="delete-records-tab">
            <h2>Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§</h2>
            <div class="instructions">
                <p>Ø§Ø² Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ø±Ø§ Ø¨Ù‡ Ø¯Ùˆ Ø±ÙˆØ´ Ø­Ø°Ù Ú©Ù†ÛŒØ¯:</p>
            </div>
            <BR>
            <div class="form-group">
                <h3><li>Ø­Ø°Ù Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ®</li></h3>
                <label for="deleteBeforeDate">Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ Ø§Ø² ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="deleteBeforeDate">
                <button id="deleteByDateBtn" class="danger" style="margin-top: 10px;">Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒÙ† ØªØ§Ø±ÛŒØ®</button>
            </div>
            <div class="form-group">
                <h3><li>Ø­Ø°Ù Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²</li></h3>
                <label for="deleteDays">Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² (Ø±ÙˆØ²):</label>
                <input type="number" id="deleteDays" min="1" max="365" value="30" placeholder="ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²">
                <button id="deleteByDaysBtn" class="danger" style="margin-top: 10px;">Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ</button>
            </div>
            <div class="instructions" style="margin-top: 20px;">
                <p><strong>Ù‡Ø´Ø¯Ø§Ø±:</strong> Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø°Ù Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.
Ù‚Ø¨Ù„ Ø§Ø² Ø­Ø°Ù Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ú¯ÛŒØ±ÛŒØ¯.</p>
            </div>
        </div>
        <div class="signature">
            Ø·Ø±Ø§Ø­ÛŒ Ùˆ Ø³Ø§Ø®Øª ØªÙˆØ³Ø· â¤ï¸ Ø³Ø¹ÛŒØ¯ Ø´ÛŒØ® Ø§Ø­Ù…Ø¯ ØµÙØ§Ø±ÛŒ
        </div>
    </div>
    <div class="modal" id="editCurrencyPairModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ÙˆÛŒØ±Ø§ÛŒØ´ Ø¬ÙØª Ø§Ø±Ø²</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="editCurrencyPairInput">Ù†Ø§Ù… Ø¬ÙØª Ø§Ø±Ø²:</label>
                <input type="text" id="editCurrencyPairInput">
            </div>
            <div class="form-group">
                <label for="editCurrencyPairCategory">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</label>
                <select id="editCurrencyPairCategory">
                    <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ --</option>
                </select>
            </div>
            <div class="button-group">
                <button id="saveCurrencyPairEditBtn" class="success">Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
                <button class="close-modal danger">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>
    <div class="modal" id="editCategoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="editCategoryInput">Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</label>
                <input type="text" id="editCategoryInput">
            </div>
            <div class="button-group">
                <button id="saveCategoryEditBtn" class="success">Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
                <button class="close-modal danger">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>
    <div class="modal" id="editCalculationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="editCalculationDate">ØªØ§Ø±ÛŒØ®:</label>
                <input type="date" id="editCalculationDate">
            </div>
            <div class="form-group">
                <label for="editCurrencyPair">Ø¬ÙØª Ø§Ø±Ø²:</label>
                <input type="text" id="editCurrencyPair" readonly>
            </div>
            <div class="form-group">
                <label for="editInputY1">Ø¹Ø¯Ø¯ Ø³Ù‚Ù:</label>
                <input type="text" id="editInputY1">
            </div>
            <div class="form-group">
                <label for="editInputY2">Ø¹Ø¯Ø¯ Ú©Ù:</label>
                <input type="text" id="editInputY2">
            </div>
            <div class="form-group">
                <label for="editInputCurrentHigh">Ø³Ù‚Ù ÙØ¹Ù„ÛŒ:</label>
                <input type="text" id="editInputCurrentHigh">
            </div>
            <div class="form-group">
                <label for="editInputCurrentLow">Ú©Ù ÙØ¹Ù„ÛŒ:</label>
                <input type="text" id="editInputCurrentLow">
            </div>
            <div class="button-group">
                <button id="saveCalculationEditBtn" class="success">Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
                <button class="close-modal danger">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>
    <div class="modal" id="confirmDeleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù</h3>
                <button class="close-modal">&times;</button>
            </div>
            <p id="confirmDeleteMessage">Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ</p>
            <div class="button-group">
                <button id="confirmDeleteBtn" class="danger">Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ø´ÙˆØ¯</button>
                <button class="close-modal">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>
    <div class="modal" id="deleteCategoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</h3>
                <button class="close-modal">&times;</button>
            </div>
            <p id="deleteCategoryMessage">Ù„Ø·ÙØ§Ù‹ Ú¯Ø²ÛŒÙ†Ù‡ Ø­Ø°Ù Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:</p>
            <div class="delete-options">
                <div class="delete-option">
                    <label>
                        <input type="radio" name="deleteOption" value="categoryOnly" checked>
                        ÙÙ‚Ø· Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ Ø­Ø°Ù Ú©Ù† (Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯)
                    </label>
                </div>
                <div class="delete-option">
                    <label>
                        <input type="radio" name="deleteOption" value="categoryWithPairs">
                        Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ ØªÙ…Ø§Ù… Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ø¢Ù† Ø±Ø§ Ø­Ø°Ù Ú©Ù†
                    </label>
                </div>
            </div>
            <div class="button-group">
                <button id="confirmCategoryDeleteBtn" class="danger">Ø­Ø°Ù</button>
                <button class="close-modal">Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>
    <script>
        // Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
        let db;
        const DB_NAME = 'CurrencyCalculatorDB_V2';
        const DB_VERSION = 2;
        // Ù†Ø§Ù… Ø¬Ø¯Ø§ÙˆÙ„ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
        const STORE_CALCULATIONS = 'calculations';
        const STORE_CURRENCY_PAIRS = 'currency_pairs';
        const STORE_CATEGORIES = 'categories';
        const STORE_SETTINGS = 'settings';
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
        let currentEditId = null;
        let deleteCallback = null;
        let currentEditType = null;
        let currentDeleteCategoryId = null;
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ù¾ÛŒØ´Ø±ÙØªÙ‡
        let isDragging = false;
        let startX = 0;
        let scrollLeft = 0;
        let isDesktopOrTablet = window.matchMedia('(min-width: 769px)').matches;
        const tabs = document.getElementById('tabs');
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupAdvancedScroll();
            setupTableScroll();
        });
        // ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ… Ø§Ø³Ú©Ø±ÙˆÙ„ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ ØªØ¨â€ŒÙ‡Ø§
        function setupAdvancedScroll() {
            // Wheel event Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙÙ‚ÛŒ Ø¨Ø§ Ú†Ø±Ø® Ù…ÙˆØ³
            tabs.addEventListener('wheel', handleWheel, { passive: false });
            // Drag events
            tabs.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', doDrag);
            document.addEventListener('mouseup', endDrag);
            // Hover Ø±ÙˆÛŒ ØªØ¨â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± cursor
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('mouseenter', () => {
                    if (isDesktopOrTablet) {
                        tabs.style.cursor = 'grab';
                    }
                });
                tab.addEventListener('mouseleave', () => {
                    if (!isDragging && isDesktopOrTablet) {
                        tabs.style.cursor = 'grab';
                    }
                });
            });
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ´Ø®ÛŒØµ Ø§Ù†Ø¯Ø§Ø²Ù‡ ØµÙØ­Ù‡
            window.addEventListener('resize', () => {
                isDesktopOrTablet = window.matchMedia('(min-width: 769px)').matches;
                if (!isDesktopOrTablet) {
                    endDrag();
                    tabs.style.cursor = 'default';
                } else {
                    tabs.style.cursor = 'grab';
                }
            });
        }
        // ØªØ§Ø¨Ø¹ wheel Ø¨Ø±Ø§ÛŒ ØªØ¨â€ŒÙ‡Ø§
        function handleWheel(e) {
            if (!isDesktopOrTablet) return;
            e.preventDefault();
            const delta = e.deltaY > 0 ? 50 : -50;
            // Ø³Ø±Ø¹Øª Ø§Ø³Ú©Ø±ÙˆÙ„
            tabs.scrollLeft += delta;
        }
        // Drag functions Ø¨Ø±Ø§ÛŒ ØªØ¨â€ŒÙ‡Ø§
        function startDrag(e) {
            if (!isDesktopOrTablet) return;
            isDragging = true;
            startX = e.pageX - tabs.offsetLeft;
            scrollLeft = tabs.scrollLeft;
            tabs.style.cursor = 'grabbing';
            e.preventDefault();
        }
        function doDrag(e) {
            if (!isDragging) return;
            e.preventDefault();
            const x = e.pageX - tabs.offsetLeft;
            const walk = (x - startX) * 2;
            // Ø³Ø±Ø¹Øª drag
            tabs.scrollLeft = scrollLeft - walk;
        }
        function endDrag() {
            isDragging = false;
            if (isDesktopOrTablet) {
                tabs.style.cursor = 'grab';
            }
        }
        // ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ… Ø§Ø³Ú©Ø±ÙˆÙ„ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ ØªØ§Ø±ÛŒØ®Ú†Ù‡
        function setupTableScroll() {
            const tableContainer = document.querySelector('.table-container');
            if (!tableContainer) return;
            let isDraggingTable = false;
            let startXTable = 0;
            let scrollLeftTable = 0;
            // Wheel event: Ù‡Ù†Ø¯Ù„ Ú©Ø±Ø¯Ù† Ù‡Ø± Ø¯Ùˆ Ø¬Ù‡Øª Ø§Ø³Ú©Ø±ÙˆÙ„ (Ø¹Ù…ÙˆØ¯ÛŒ Ùˆ Ø§ÙÙ‚ÛŒ) Ø¨Ø¯ÙˆÙ† ØªØ¯Ø§Ø®Ù„
            tableContainer.addEventListener('wheel', (e) => {
                e.preventDefault(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ØµÙØ­Ù‡
                if (e.deltaY !== 0) {
                    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¹Ù…ÙˆØ¯ÛŒ: Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ scrollTop
                    tableContainer.scrollTop += e.deltaY;
                }
                if (e.deltaX !== 0) {
                    // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙÙ‚ÛŒ: Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ scrollLeft
                    tableContainer.scrollLeft += e.deltaX;
                }
            }, { passive: false });
            // Ø´Ø±ÙˆØ¹ drag Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÙÙ‚ÛŒ
            tableContainer.addEventListener('mousedown', (e) => {
                if (!isDesktopOrTablet) return;
                isDraggingTable = true;
                startXTable = e.pageX - tableContainer.offsetLeft;
                scrollLeftTable = tableContainer.scrollLeft;
                tableContainer.style.cursor = 'grabbing';
                e.preventDefault();
            });
            // Ø¯Ø± Ø­ÛŒÙ† drag
            document.addEventListener('mousemove', (e) => {
                if (!isDraggingTable) return;
                e.preventDefault();
                const x = e.pageX - tableContainer.offsetLeft;
                const walk = (x - startXTable) * 2; // Ø³Ø±Ø¹Øª drag (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…)
                tableContainer.scrollLeft = scrollLeftTable - walk;
            });
            // Ù¾Ø§ÛŒØ§Ù† drag
            document.addEventListener('mouseup', () => {
                isDraggingTable = false;
                if (isDesktopOrTablet) {
                    tableContainer.style.cursor = 'grab';
                }
            });
            tableContainer.addEventListener('mouseleave', () => {
                isDraggingTable = false;
                if (isDesktopOrTablet) {
                    tableContainer.style.cursor = 'grab';
                }
            });
            // Ø¨Ø±Ø§ÛŒ ØªØ¨Ù„Øª/Ù„Ù…Ø³: swipe Ø§ÙÙ‚ÛŒ Ø·Ø¨ÛŒØ¹ÛŒ
            tableContainer.addEventListener('touchstart', (e) => {
                startXTable = e.touches[0].pageX - tableContainer.offsetLeft;
                scrollLeftTable = tableContainer.scrollLeft;
            });
            tableContainer.addEventListener('touchmove', (e) => {
                const x = e.touches[0].pageX - tableContainer.offsetLeft;
                const walk = (x - startXTable) * 2;
                tableContainer.scrollLeft = scrollLeftTable - walk;
                e.preventDefault(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ ØµÙØ­Ù‡
            }, { passive: false });
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ cursor Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†Ø¯Ø§Ø²Ù‡ ØµÙØ­Ù‡
            window.addEventListener('resize', () => {
                isDesktopOrTablet = window.matchMedia('(min-width: 769px)').matches;
                tableContainer.style.cursor = isDesktopOrTablet ? 'grab' : 'default';
                if (!isDesktopOrTablet) {
                    isDraggingTable = false;
                }
            });
        }
        // ØªØ§Ø¨Ø¹ Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…ØªÙ† (Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ Ùˆ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§)
        function copyToClipboard(element, text = null) {
            // ØªØºÛŒÛŒØ± Ø§ÙˆÙ„ÙˆÛŒØª: Ø§Ú¯Ø± dataset.value Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯ØŒ Ø§Ø² Ø¢Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù† (ÙÙ‚Ø· Ø¹Ø¯Ø¯ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§)
            const textToCopy = text || (element.dataset.value || element.textContent.trim());
            if (!textToCopy) return;
            navigator.clipboard.writeText(textToCopy).then(() => {
                element.classList.add('copied');
                showNotification('Ú©Ù¾ÛŒ Ø´Ø¯! (' + textToCopy + ')', 'success', 2000);
                setTimeout(() => {
                    element.classList.remove('copied');
                }, 1500);
            }).catch(err => {
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                element.classList.add('copied');
                showNotification('Ú©Ù¾ÛŒ Ø´Ø¯! (' + textToCopy + ')', 'success', 2000);
                setTimeout(() => {
                    element.classList.remove('copied');
                }, 1500);
            });
        }
        // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù†
        function showNotification(message, type = 'success', duration = 3000) {
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button class="notification-close">&times;</button>
            `;
            document.body.appendChild(notification);
            notification.querySelector('.notification-close').addEventListener('click', function() {
                notification.remove();
            });
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, duration);
            }
        }
        // ØªØ§Ø¨Ø¹ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø±Ù†Ø§Ù…Ù‡
        async function initializeApp() {
            await initializeDatabase();
            await loadCategories();
            await loadCurrencyPairs();
            setupEventListeners();
            setDefaultDate();
            loadCalculationsTable();
            document.getElementById('filterCurrencyPair').addEventListener('change', loadCalculationsTable);
            document.getElementById('filterDate').addEventListener('change', loadCalculationsTable);
            // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾ Ùˆ Ù…ÙˆØ¨Ø§ÛŒÙ„
            syncInputFields();
        }
        // ØªØ§Ø¨Ø¹ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾ Ùˆ Ù…ÙˆØ¨Ø§ÛŒÙ„
        function syncInputFields() {
            // ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾
            const desktopFields = {
                y1: document.getElementById('input_y1'),
                y2: document.getElementById('input_y2'),
                currentHigh: document.getElementById('input_current_high'),
                currentLow: document.getElementById('input_current_low')
            };
            // ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
            const mobileFields = {
                y1: document.getElementById('input_y1_mobile'),
                y2: document.getElementById('input_y2_mobile'),
                currentHigh: document.getElementById('input_current_high_mobile'),
                currentLow: document.getElementById('input_current_low_mobile')
            };
            // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² Ø¯Ø³Ú©ØªØ§Ù¾ Ø¨Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
            Object.keys(desktopFields).forEach(key => {
                desktopFields[key].addEventListener('input', function() {
                    mobileFields[key].value = this.value;
                });
            });
            // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ù‡ Ø¯Ø³Ú©ØªØ§Ù¾
            Object.keys(mobileFields).forEach(key => {
                mobileFields[key].addEventListener('input', function() {
                    desktopFields[key].value = this.value;
                });
            });
        }
        // ØªØ§Ø¨Ø¹ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
        function initializeDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                request.onerror = () => {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡');
                    reject('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡');
                };
                request.onsuccess = (event) => {
                    db = event.target.result;
                    resolve(db);
                };
                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_CALCULATIONS)) {
                        const calculationsStore = db.createObjectStore(STORE_CALCULATIONS, { 
                            keyPath: 'id', 
                            autoIncrement: true 
                        });
                        calculationsStore.createIndex('date', 'date', { unique: false });
                        calculationsStore.createIndex('currencyPair', 'currencyPair', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORE_CURRENCY_PAIRS)) {
                        const currencyPairsStore = db.createObjectStore(STORE_CURRENCY_PAIRS, { 
                            keyPath: 'id', 
                            autoIncrement: true 
                        });
                        currencyPairsStore.createIndex('name', 'name', { unique: true });
                        currencyPairsStore.createIndex('order', 'order', { unique: false });
                        currencyPairsStore.createIndex('categoryId', 'categoryId', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORE_CATEGORIES)) {
                        const categoriesStore = db.createObjectStore(STORE_CATEGORIES, { 
                            keyPath: 'id', 
                            autoIncrement: true 
                        });
                        categoriesStore.createIndex('name', 'name', { unique: true });
                        categoriesStore.createIndex('order', 'order', { unique: false });
                    }
                    if (!db.objectStoreNames.contains(STORE_SETTINGS)) {
                        const settingsStore = db.createObjectStore(STORE_SETTINGS, { 
                            keyPath: 'id'
                        });
                    }
                };
            });
        }
        // ØªØ§Ø¨Ø¹ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
        function saveToDatabase(storeName, data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(data);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        // ØªØ§Ø¨Ø¹ Ø®ÙˆØ§Ù†Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
        function getAllFromDatabase(storeName, indexName = null, query = null) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = indexName ? store.index(indexName).getAll(query) : store.getAll();
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        // ØªØ§Ø¨Ø¹ Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡ Ø§Ø² Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
        function deleteFromDatabase(storeName, id) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(id);
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }
        // ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ù‡ Ø§Ù…Ø±ÙˆØ² (Ù…ÛŒÙ„Ø§Ø¯ÛŒ)
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('calculationDate').value = today;
        }
        // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
        async function loadCategories() {
            try {
                let categories = await getAllFromDatabase(STORE_CATEGORIES);
                categories.sort((a, b) => (a.order || 0) - (b.order || 0));
                const categorySelect = document.getElementById('currencyPairCategory');
                const editCategorySelect = document.getElementById('editCurrencyPairCategory');
                while (categorySelect.children.length > 1) {
                    categorySelect.removeChild(categorySelect.lastChild);
                }
                while (editCategorySelect.children.length > 1) {
                    editCategorySelect.removeChild(editCategorySelect.lastChild);
                }
                categories.forEach(category => {
                    const option1 = document.createElement('option');
                    option1.value = category.id;
                    option1.textContent = category.name;
                    categorySelect.appendChild(option1);
                    const option2 = document.createElement('option');
                    option2.value = category.id;
                    option2.textContent = category.name;
                    editCategorySelect.appendChild(option2);
                });
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§:', error);
            }
        }
        // ØªØ§Ø¨Ø¹ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¬Ø¯ÛŒØ¯
        async function addCategory() {
            const newCategoryInput = document.getElementById('newCategoryName');
            const categoryName = newCategoryInput.value.trim();
            if (!categoryName) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'warning');
                return;
            }
            try {
                const categories = await getAllFromDatabase(STORE_CATEGORIES);
                const maxOrder = categories.length > 0 ? Math.max(...categories.map(c => c.order || 0)) : -1;
                await saveToDatabase(STORE_CATEGORIES, {
                    name: categoryName,
                    order: maxOrder + 1,
                    createdAt: new Date().toISOString()
                });
                newCategoryInput.value = '';
                await loadCategories();
                await loadCurrencyPairs();
                showNotification('Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:', error);
                if (error.name === 'ConstraintError') {
                    showNotification('Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.', 'error');
                } else {
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ.', 'error');
                }
            }
        }
        // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
        function openEditCategoryModal(id, name) {
            currentEditId = id;
            currentEditType = 'category';
            document.getElementById('editCategoryInput').value = name;
            document.getElementById('editCategoryModal').style.display = 'flex';
        }
        // ØªØ§Ø¨Ø¹ Ø°Ø®ÛŒØ±Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
        async function saveCategoryEdit() {
            const newName = document.getElementById('editCategoryInput').value.trim();
            if (!newName) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'warning');
                return;
            }
            try {
                const categories = await getAllFromDatabase(STORE_CATEGORIES);
                const existingCategory = categories.find(c => c.id === parseInt(currentEditId));
                if (existingCategory) {
                    await saveToDatabase(STORE_CATEGORIES, {
                        ...existingCategory,
                        name: newName
                    });
                    closeModals();
                    await loadCategories();
                    await loadCurrencyPairs();
                    showNotification('Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:', error);
                if (error.name === 'ConstraintError') {
                    showNotification('Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.', 'error');
                } else {
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ.', 'error');
                }
            }
        }
        // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
        function openDeleteCategoryModal(id, name) {
            currentDeleteCategoryId = id;
            document.getElementById('deleteCategoryMessage').textContent = 
                `Ù„Ø·ÙØ§Ù‹ Ú¯Ø²ÛŒÙ†Ù‡ Ø­Ø°Ù Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ "${name}" Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:`;
            document.getElementById('deleteCategoryModal').style.display = 'flex';
        }
        // ØªØ§Ø¨Ø¹ Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
        async function deleteCategory() {
            const deleteOption = document.querySelector('input[name="deleteOption"]:checked').value;
            try {
                if (deleteOption === 'categoryOnly') {
                    // ÙÙ‚Ø· Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ø°Ù Ø´ÙˆØ¯ØŒ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯
                    const currencyPairs = await getAllFromDatabase(STORE_CURRENCY_PAIRS);
                    const pairsInCategory = currencyPairs.filter(p => p.categoryId === parseInt(currentDeleteCategoryId));
                    for (const pair of pairsInCategory) {
                        await saveToDatabase(STORE_CURRENCY_PAIRS, {
                            ...pair,
                            categoryId: null
                        });
                    }
                    await deleteFromDatabase(STORE_CATEGORIES, parseInt(currentDeleteCategoryId));
                    showNotification('Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ø°Ù Ø´Ø¯. Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù†Ø¯.');
                } else if (deleteOption === 'categoryWithPairs') {
                    // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ ØªÙ…Ø§Ù… Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ Ø¢Ù† Ø­Ø°Ù Ø´ÙˆÙ†Ø¯
                    const currencyPairs = await getAllFromDatabase(STORE_CURRENCY_PAIRS);
                    const pairsInCategory = currencyPairs.filter(p => p.categoryId === parseInt(currentDeleteCategoryId));
                    for (const pair of pairsInCategory) {
                        await deleteFromDatabase(STORE_CURRENCY_PAIRS, pair.id);
                    }
                    await deleteFromDatabase(STORE_CATEGORIES, parseInt(currentDeleteCategoryId));
                    showNotification('Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ùˆ ØªÙ…Ø§Ù… Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ÛŒ Ø¢Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.');
                }
                closeModals();
                await loadCategories();
                await loadCurrencyPairs();
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ.', 'error');
            }
        }
        // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ Ø¨Ø§ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
        async function loadCurrencyPairs() {
            try {
                let currencyPairs = await getAllFromDatabase(STORE_CURRENCY_PAIRS);
                let categories = await getAllFromDatabase(STORE_CATEGORIES);
                currencyPairs.sort((a, b) => (a.order || 0) - (b.order || 0));
                categories.sort((a, b) => (a.order || 0) - (b.order || 0));
                const currencyPairSelect = document.getElementById('currencyPairSelect');
                const filterCurrencyPair = document.getElementById('filterCurrencyPair');
                const comparisonCurrencyPair = document.getElementById('comparisonCurrencyPair');
                while (currencyPairSelect.children.length > 1) {
                    currencyPairSelect.removeChild(currencyPairSelect.lastChild);
                }
                while (filterCurrencyPair.children.length > 1) {
                    filterCurrencyPair.removeChild(filterCurrencyPair.lastChild);
                }
                while (comparisonCurrencyPair.children.length > 1) {
                    comparisonCurrencyPair.removeChild(comparisonCurrencyPair.lastChild);
                }
                // ÙÙ‚Ø· Ù†Ø§Ù… Ø¬ÙØª Ø§Ø±Ø² Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                currencyPairs.forEach(pair => {
                    const option1 = document.createElement('option');
                    option1.value = pair.name;
                    option1.textContent = pair.name;
                    currencyPairSelect.appendChild(option1);
                    const option2 = document.createElement('option');
                    option2.value = pair.name;
                    option2.textContent = pair.name;
                    filterCurrencyPair.appendChild(option2);
                    const option3 = document.createElement('option');
                    option3.value = pair.name;
                    option3.textContent = pair.name;
                    comparisonCurrencyPair.appendChild(option3);
                });
                updateCurrencyPairsList(currencyPairs, categories);
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§:', error);
            }
        }
        // ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
        function updateCurrencyPairsList(currencyPairs, categories) {
            const currencyPairsList = document.getElementById('currencyPairsList');
            currencyPairsList.innerHTML = '';
            if (currencyPairs.length === 0 && categories.length === 0) {
                currencyPairsList.innerHTML = '<p>Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ÛŒØ§ Ø¬ÙØª Ø§Ø±Ø²ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>';
                return;
            }
            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
            categories.forEach(category => {
                const categoryPairs = currencyPairs.filter(p => p.categoryId === category.id);
                const categorySection = document.createElement('div');
                categorySection.className = 'category-section';
                categorySection.setAttribute('data-category-id', category.id);
                categorySection.innerHTML = `
                    <div class="category-header" onclick="toggleCategory('${category.id}')">
                        <div class="category-title">
                            <span class="collapse-icon">â–¼</span>
                            ${category.name}
                        </div>
                        <div class="category-actions">
                            <button class="icon-btn edit-icon edit-category" data-id="${category.id}" data-name="${category.name}" title="ÙˆÛŒØ±Ø§ÛŒØ´">âœï¸</button>
                            <button class="icon-btn delete-icon delete-category" data-id="${category.id}" data-name="${category.name}" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <div class="category-pairs" id="category-${category.id}">
                        ${categoryPairs.length === 0 ?
                            '<p style="text-align: center; color: #666; padding: 10px; margin: 0;">Ù‡ÛŒÚ† Ø¬ÙØª Ø§Ø±Ø²ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>' : 
                            ''}
                    </div>
                `;
                currencyPairsList.appendChild(categorySection);
                const categoryPairsContainer = document.getElementById(`category-${category.id}`);
                categoryPairs.forEach((pair, index) => {
                    const pairElement = document.createElement('div');
                    pairElement.className = 'currency-pair-item';
                    pairElement.setAttribute('draggable', 'true');
                    pairElement.setAttribute('data-pair-id', pair.id);
                    pairElement.setAttribute('data-category-id', category.id);
                    pairElement.innerHTML = `
                        <div class="currency-pair-name">${pair.name}</div>
                        <div class="currency-pair-actions">
                            <div class="move-buttons">
                                <button class="move-btn move-up" data-id="${pair.id}" ${index === 0 ? 'disabled' : ''}>â†‘</button>
                                <button class="move-btn move-down" data-id="${pair.id}" ${index === categoryPairs.length - 1 ? 'disabled' : ''}>â†“</button>
                            </div>
                            <button class="action-btn edit-currency-pair" data-id="${pair.id}" data-name="${pair.name}" data-category="${pair.categoryId}">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button class="action-btn danger delete-currency-pair" data-id="${pair.id}" data-name="${pair.name}">Ø­Ø°Ù</button>
                        </div>
                    `;
                    categoryPairsContainer.appendChild(pairElement);
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listeners Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ú¯ Ø§Ù†Ø¯ Ø¯Ø±Ø§Ù¾
                    setupDragAndDrop(pairElement);
                });
            });
            // Ù†Ù…Ø§ÛŒØ´ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ÛŒ Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
            const uncategorizedPairs = currencyPairs.filter(p => !p.categoryId);
            if (uncategorizedPairs.length > 0) {
                const uncategorizedSection = document.createElement('div');
                uncategorizedSection.className = 'category-section';
                uncategorizedSection.setAttribute('data-category-id', 'uncategorized');
                uncategorizedSection.innerHTML = `
                    <div class="category-header" onclick="toggleCategory('uncategorized')">
                        <div class="category-title">
                            <span class="collapse-icon">â–¼</span>
                            Ø¨Ø¯ÙˆÙ† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
                        </div>
                    </div>
                    <div class="category-pairs" id="uncategorized-pairs">
                    </div>
                `;
                currencyPairsList.appendChild(uncategorizedSection);
                const uncategorizedContainer = document.getElementById('uncategorized-pairs');
                uncategorizedPairs.forEach((pair, index) => {
                    const pairElement = document.createElement('div');
                    pairElement.className = 'currency-pair-item';
                    pairElement.setAttribute('draggable', 'true');
                    pairElement.setAttribute('data-pair-id', pair.id);
                    pairElement.setAttribute('data-category-id', 'uncategorized');
                    pairElement.innerHTML = `
                        <div class="currency-pair-name">${pair.name}</div>
                        <div class="currency-pair-actions">
                            <div class="move-buttons">
                                <button class="move-btn move-up" data-id="${pair.id}" ${index === 0 ? 'disabled' : ''}>â†‘</button>
                                <button class="move-btn move-down" data-id="${pair.id}" ${index === uncategorizedPairs.length - 1 ? 'disabled' : ''}>â†“</button>
                            </div>
                            <button class="action-btn edit-currency-pair" data-id="${pair.id}" data-name="${pair.name}" data-category="">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button class="action-btn danger delete-currency-pair" data-id="${pair.id}" data-name="${pair.name}">Ø­Ø°Ù</button>
                        </div>
                    `;
                    uncategorizedContainer.appendChild(pairElement);
                    setupDragAndDrop(pairElement);
                });
            }
            setupAllEventListeners();
        }
        // ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ… Ø¯Ø±Ú¯ Ø§Ù†Ø¯ Ø¯Ø±Ø§Ù¾ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø¢ÛŒØªÙ…
        function setupDragAndDrop(element) {
            let dragItem = null;
            element.addEventListener('dragstart', function(e) {
                dragItem = this;
                this.classList.add('dragging');
                e.dataTransfer.setData('text/plain', this.getAttribute('data-pair-id'));
                e.dataTransfer.effectAllowed = 'move';
            });
            element.addEventListener('dragend', function() {
                this.classList.remove('dragging');
                document.querySelectorAll('.currency-pair-item').forEach(item => {
                    item.classList.remove('drag-over');
                });
                dragItem = null;
            });
            element.addEventListener('dragover', function(e) {
                e.preventDefault();
                if (dragItem && dragItem !== this) {
                    this.classList.add('drag-over');
                }
            });
            element.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            element.addEventListener('drop', async function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                if (!dragItem || dragItem === this) return;
                const draggedId = parseInt(dragItem.getAttribute('data-pair-id'));
                const targetId = parseInt(this.getAttribute('data-pair-id'));
                const categoryId = this.getAttribute('data-category-id');
                await reorderPairs(draggedId, targetId, categoryId);
            });
        }
        // ØªØ§Ø¨Ø¹ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§
        async function reorderPairs(draggedId, targetId, categoryId) {
            try {
                let currencyPairs = await getAllFromDatabase(STORE_CURRENCY_PAIRS);
                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§
                const draggedIndex = currencyPairs.findIndex(p => p.id === draggedId);
                const targetIndex = currencyPairs.findIndex(p => p.id === targetId);
                if (draggedIndex === -1 || targetIndex === -1) return;
                // Ø­Ø°Ù Ø¢ÛŒØªÙ… Ú©Ø´ÛŒØ¯Ù‡ Ø´Ø¯Ù‡ Ùˆ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† Ø¢Ù† Ø¯Ø± Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯
                const [draggedItem] = currencyPairs.splice(draggedIndex, 1);
                currencyPairs.splice(targetIndex, 0, draggedItem);
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ order Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§
                currencyPairs.forEach((pair, index) => {
                    pair.order = index;
                });
                // Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                for (const pair of currencyPairs) {
                    await saveToDatabase(STORE_CURRENCY_PAIRS, pair);
                }
                await loadCurrencyPairs();
                showNotification('ØªØ±ØªÛŒØ¨ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§.', 'error');
            }
        }
        // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
        function toggleCategory(categoryId) {
            const pairsContainer = document.getElementById(`category-${categoryId}`);
            const collapseIcon = pairsContainer.parentElement.querySelector('.collapse-icon');
            if (pairsContainer.classList.contains('collapsed')) {
                pairsContainer.classList.remove('collapsed');
                collapseIcon.textContent = 'â–¼';
            } else {
                pairsContainer.classList.add('collapsed');
                collapseIcon.textContent = 'â–¶';
            }
        }
        // ØªØ§Ø¨Ø¹ Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø¬ÙØª Ø§Ø±Ø² Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
        async function moveCurrencyPair(id, direction) {
            try {
                let currencyPairs = await getAllFromDatabase(STORE_CURRENCY_PAIRS);
                currencyPairs.sort((a, b) => (a.order || 0) - (b.order || 0));
                const currentIndex = currencyPairs.findIndex(p => p.id === id);
                if (currentIndex === -1) return;
                if (direction === 'up' && currentIndex > 0) {
                    const tempOrder = currencyPairs[currentIndex].order ||
                        currentIndex;
                    currencyPairs[currentIndex].order = currencyPairs[currentIndex - 1].order || currentIndex - 1;
                    currencyPairs[currentIndex - 1].order = tempOrder;
                } else if (direction === 'down' && currentIndex < currencyPairs.length - 1) {
                    const tempOrder = currencyPairs[currentIndex].order ||
                        currentIndex;
                    currencyPairs[currentIndex].order = currencyPairs[currentIndex + 1].order || currentIndex + 1;
                    currencyPairs[currentIndex + 1].order = tempOrder;
                } else {
                    return;
                }
                for (const pair of currencyPairs) {
                    await saveToDatabase(STORE_CURRENCY_PAIRS, pair);
                }
                await loadCurrencyPairs();
                showNotification('ØªØ±ØªÛŒØ¨ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø¬ÙØª Ø§Ø±Ø²:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø¬ÙØª Ø§Ø±Ø².', 'error');
            }
        }
        // ØªØ§Ø¨Ø¹ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¬ÙØª Ø§Ø±Ø² Ø¬Ø¯ÛŒØ¯
        async function addCurrencyPair() {
            const newCurrencyPairInput = document.getElementById('newCurrencyPair');
            const categorySelect = document.getElementById('currencyPairCategory');
            const pairName = newCurrencyPairInput.value.trim();
            const categoryId = categorySelect.value ? parseInt(categorySelect.value) : null;
            if (!pairName) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¬ÙØª Ø§Ø±Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'warning');
                return;
            }
            try {
                const currencyPairs = await getAllFromDatabase(STORE_CURRENCY_PAIRS);
                const maxOrder = currencyPairs.length > 0 ? Math.max(...currencyPairs.map(p => p.order || 0)) : -1;
                await saveToDatabase(STORE_CURRENCY_PAIRS, {
                    name: pairName,
                    categoryId: categoryId,
                    order: maxOrder + 1,
                    createdAt: new Date().toISOString()
                });
                newCurrencyPairInput.value = '';
                categorySelect.value = '';
                await loadCurrencyPairs();
                showNotification('Ø¬ÙØª Ø§Ø±Ø² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¬ÙØª Ø§Ø±Ø²:', error);
                if (error.name === 'ConstraintError') {
                    showNotification('Ø§ÛŒÙ† Ø¬ÙØª Ø§Ø±Ø² Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.', 'error');
                } else {
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¬ÙØª Ø§Ø±Ø².', 'error');
                }
            }
        }
        // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¬ÙØª Ø§Ø±Ø²
        function openEditCurrencyPairModal(id, name, categoryId) {
            currentEditId = id;
            currentEditType = 'currencyPair';
            document.getElementById('editCurrencyPairInput').value = name;
            document.getElementById('editCurrencyPairCategory').value = categoryId || '';
            document.getElementById('editCurrencyPairModal').style.display = 'flex';
        }
        // ØªØ§Ø¨Ø¹ Ø°Ø®ÛŒØ±Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¬ÙØª Ø§Ø±Ø²
        async function saveCurrencyPairEdit() {
            const newName = document.getElementById('editCurrencyPairInput').value.trim();
            const categoryId = document.getElementById('editCurrencyPairCategory').value ? parseInt(document.getElementById('editCurrencyPairCategory').value) : null;
            if (!newName) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø¬ÙØª Ø§Ø±Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'warning');
                return;
            }
            try {
                const currencyPairs = await getAllFromDatabase(STORE_CURRENCY_PAIRS);
                const existingPair = currencyPairs.find(p => p.id === parseInt(currentEditId));
                if (existingPair) {
                    await saveToDatabase(STORE_CURRENCY_PAIRS, {
                        ...existingPair,
                        name: newName,
                        categoryId: categoryId
                    });
                    closeModals();
                    await loadCurrencyPairs();
                    showNotification('Ø¬ÙØª Ø§Ø±Ø² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ø¬ÙØª Ø§Ø±Ø²:', error);
                if (error.name === 'ConstraintError') {
                    showNotification('Ø§ÛŒÙ† Ø¬ÙØª Ø§Ø±Ø² Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.', 'error');
                } else {
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ø¬ÙØª Ø§Ø±Ø².', 'error');
                }
            }
        }
        // ØªØ§Ø¨Ø¹ Ø­Ø°Ù Ø¬ÙØª Ø§Ø±Ø²
        async function deleteCurrencyPair(id) {
            try {
                await deleteFromDatabase(STORE_CURRENCY_PAIRS, parseInt(id));
                await loadCurrencyPairs();
                showNotification('Ø¬ÙØª Ø§Ø±Ø² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¬ÙØª Ø§Ø±Ø²:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¬ÙØª Ø§Ø±Ø².', 'error');
            }
        }
        // ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ… event listenerÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§
        function setupAllEventListeners() {
            document.querySelectorAll('.edit-category').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const name = this.getAttribute('data-name');
                    openEditCategoryModal(id, name);
                });
            });
            document.querySelectorAll('.delete-category').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const name = this.getAttribute('data-name');
                    openDeleteCategoryModal(id, name);
                });
            });
            document.querySelectorAll('.edit-currency-pair').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const name = this.getAttribute('data-name');
                    const categoryId = this.getAttribute('data-category');
                    openEditCurrencyPairModal(id, name, categoryId);
                });
            });
            document.querySelectorAll('.delete-currency-pair').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const name = this.getAttribute('data-name');
                    showConfirmDeleteModal(
                        `Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø¬ÙØª Ø§Ø±Ø² "${name}" Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.`,
                        () => deleteCurrencyPair(id)
                    );
                });
            });
            document.querySelectorAll('.move-up:not([data-type])').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    moveCurrencyPair(id, 'up');
                });
            });
            document.querySelectorAll('.move-down:not([data-type])').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    moveCurrencyPair(id, 'down');
                });
            });
        }

        // ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: ØªØ¬Ø²ÛŒÙ‡ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø³Ø§Ø®ØªØ§Ø± Ù†Ù‚Ø·Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ ÙˆØ±ÙˆØ¯ÛŒ
        function analyzeInputFormat(input) {
            if (!input) {
                return { hasDot: false, leftPart: '', rightPart: '', totalLength: 0 };
            }
            
            const dotIndex = input.indexOf('.');
            
            if (dotIndex === -1) {
                // Ø¨Ø¯ÙˆÙ† Ù†Ù‚Ø·Ù‡
                return { 
                    hasDot: false, 
                    leftPart: input, 
                    rightPart: '', 
                    totalLength: input.length,
                    leftLength: input.length,
                    rightLength: 0
                };
            } else {
                // Ø¨Ø§ Ù†Ù‚Ø·Ù‡
                const leftPart = input.substring(0, dotIndex);
                const rightPart = input.substring(dotIndex + 1);
                return { 
                    hasDot: true, 
                    leftPart: leftPart, 
                    rightPart: rightPart, 
                    totalLength: input.length - 1, // Ø¨Ø¯ÙˆÙ† Ù†Ù‚Ø·Ù‡
                    leftLength: leftPart.length,
                    rightLength: rightPart.length
                };
            }
        }

        // ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: ØªØ¨Ø¯ÛŒÙ„ Ø¹Ø¯Ø¯ Ø¨Ù‡ ÙØ±Ù…Øª Ù†Ù‚Ø·Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ø´Ø®Øµ
        function formatNumberWithDotPattern(number, format) {
            if (!format.hasDot) {
                return number.toString();
            }
            
            const decimals = format.rightLength || 0;
            if (decimals === 0) {
                return number.toString();
            }
            
            let numStr = number.toString();
            // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ø­Ø¯Ø§Ù‚Ù„ Ø¨Ù‡ Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø´Ø§Ø±ØŒ Ø±Ù‚Ù… Ø¯Ø§Ø±ÛŒÙ…
            if (numStr.length <= decimals) {
                numStr = numStr.padStart(decimals + 1, '0');
            }
            
            const intPart = numStr.slice(0, -decimals);
            const fracPart = numStr.slice(-decimals);
            
            return intPart + '.' + fracPart;
        }

        // ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: ØªØ¬Ø²ÛŒÙ‡ Ø¹Ø¯Ø¯ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø§ Ø­ÙØ¸ Ø³Ø§Ø®ØªØ§Ø± Ù†Ù‚Ø·Ù‡
        function parseNumberInput(input) {
            const format = analyzeInputFormat(input);
            const numericValue = parseInt(input.replace('.', '')) || 0;
            return { numericValue, format };
        }

        // ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯: ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø¹Ø¯Ø¯ Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ø®ØªØ§Ø± ÙˆØ±ÙˆØ¯ÛŒ
        function formatNumberBasedOnInput(number, inputFormat) {
            return formatNumberWithDotPattern(number, inputFormat);
        }

        // ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ø®Ø±ÙˆØ¬ÛŒ Ù‚Ø§Ø¨Ù„ Ú©Ù„ÛŒÚ© - Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø´Ø¯Ù‡
        function createClickableOutput(label, value, currentLow, currentHigh, inputFormat) {
            let colorClass = '';
            let suffix = '';
            if (value < currentLow) {
                colorClass = 'below-low';
                suffix = ' â†“ Ø²ÛŒØ± Ú©Ù ÙØ¹Ù„ÛŒ';
            } else if (value > currentHigh) {
                colorClass = 'above-high';
                suffix = ' â†‘ Ø¨Ø§Ù„Ø§ÛŒ Ø³Ù‚Ù ÙØ¹Ù„ÛŒ';
            }
            
            const displayValue = formatNumberBasedOnInput(value, inputFormat);
            const fullDisplayText = `${label}: ${displayValue}${suffix}`;
            const textToCopy = displayValue;
            
            const div = document.createElement('div');
            div.className = `result ${colorClass}`;
            div.textContent = fullDisplayText;
            div.title = `Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ø¹Ø¯Ø¯ (${textToCopy}) Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯`;
            div.dataset.value = textToCopy;
            div.addEventListener('click', function() {
                copyToClipboard(this);
            });
            return div;
        }

        // ØªØ§Ø¨Ø¹ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø°Ø®ÛŒØ±Ù‡ - Ù…Ù†Ø·Ù‚ Ø¬Ø¯ÛŒØ¯
        async function calculateAndSave() {
            try {
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾ Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡
                const y1Value = document.getElementById('input_y1').value.trim();
                const y2Value = document.getElementById('input_y2').value.trim();
                const currentHighValue = document.getElementById('input_current_high').value.trim();
                const currentLowValue = document.getElementById('input_current_low').value.trim();
                const currencyPair = document.getElementById('currencyPairSelect').value;
                const calculationDate = document.getElementById('calculationDate').value;
                
                if (!y1Value || !y2Value || !currentHighValue || !currentLowValue) {
                    throw new Error("Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!");
                }
                if (!currencyPair) {
                    throw new Error("Ù„Ø·ÙØ§Ù‹ Ø¬ÙØª Ø§Ø±Ø² Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!");
                }
                if (!calculationDate) {
                    throw new Error("Ù„Ø·ÙØ§Ù‹ ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!");
                }

                // ØªØ¬Ø²ÛŒÙ‡ Ø§Ø¹Ø¯Ø§Ø¯ ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø§ Ø­ÙØ¸ Ø³Ø§Ø®ØªØ§Ø± Ù†Ù‚Ø·Ù‡
                const y1Parsed = parseNumberInput(y1Value);
                const y2Parsed = parseNumberInput(y2Value);
                const currentHighParsed = parseNumberInput(currentHighValue);
                const currentLowParsed = parseNumberInput(currentLowValue);

                const y1 = y1Parsed.numericValue;
                const y2 = y2Parsed.numericValue;
                const currentHigh = currentHighParsed.numericValue;
                const currentLow = currentLowParsed.numericValue;

                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ
                const resultsList = document.getElementById('results_list');
                const errorMessage = document.getElementById('error_message');
                resultsList.innerHTML = '';
                errorMessage.style.display = 'none';

                if (isNaN(y1) || isNaN(y2) || isNaN(currentHigh) || isNaN(currentLow)) {
                    throw new Error("Ù„Ø·ÙØ§Ù‹ Ø§Ø¹Ø¯Ø§Ø¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!");
                }
                if (y1 < 0 || y2 < 0 || currentHigh < 0 || currentLow < 0) {
                    throw new Error("Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø§Ø¹Ø¯Ø§Ø¯ Ù…Ø«Ø¨Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
                }

                // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ±Ù…ÙˆÙ„â€ŒÙ‡Ø§ - Ù…Ù†Ø·Ù‚ Ø¬Ø¯ÛŒØ¯
                const result1 = Math.floor((Math.sqrt(y1) - 1) ** 2);
                const result2 = Math.floor((Math.sqrt(y1) - 0.5) ** 2);
                const result3 = Math.floor((Math.sqrt(y2) + 1) ** 2);
                const result4 = Math.floor((Math.sqrt(y2) + 0.5) ** 2);

                // Ø§ÛŒØ¬Ø§Ø¯ Ø¢Ø±Ø§ÛŒÙ‡ Ù†ØªØ§ÛŒØ¬ Ùˆ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
                const results = [
                    { label: "ÙØ±Ù…ÙˆÙ„ Û±", value: result1 },
                    { label: "ÙØ±Ù…ÙˆÙ„ Û²", value: result2 },
                    { label: "ÙØ±Ù…ÙˆÙ„ Û³", value: result3 },
                    { label: "ÙØ±Ù…ÙˆÙ„ Û´", value: result4 }
                ];

                // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² Ú©ÙˆÚ†Ú© Ø¨Ù‡ Ø¨Ø²Ø±Ú¯
                results.sort((a, b) => a.value - b.value);

                // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬ Ù…Ø±ØªØ¨â€ŒØ´Ø¯Ù‡ Ø¨Ø§ Ø­ÙØ¸ Ø³Ø§Ø®ØªØ§Ø± Ù†Ù‚Ø·Ù‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ
                results.forEach((result, index) => {
                    const newLabel = `${index + 1}. (Ø§Ø² ${result.label})`;
                    const inputFormat = index < 2 ? y1Parsed.format : y2Parsed.format;
                    const resultElement = createClickableOutput(
                        newLabel, 
                        result.value, 
                        currentLow, 
                        currentHigh, 
                        inputFormat
                    );
                    resultsList.appendChild(resultElement);
                });

                // Ø§Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù‡Ø³ØªÛŒÙ…ØŒ Ø±Ú©ÙˆØ±Ø¯ Ù‚Ø¯ÛŒÙ… Ø±Ø§ Ø­Ø°Ù Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                if (currentEditId) {
                    await deleteFromDatabase(STORE_CALCULATIONS, currentEditId);
                    currentEditId = null;
                }

                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡
                await saveToDatabase(STORE_CALCULATIONS, {
                    date: calculationDate,
                    currencyPair: currencyPair,
                    inputY1: y1,
                    inputY2: y2,
                    inputCurrentHigh: currentHigh,
                    inputCurrentLow: currentLow,
                    inputFormatY1: y1Parsed.format,
                    inputFormatY2: y2Parsed.format,
                    result1: result1,
                    result2: result2,
                    result3: result3,
                    result4: result4,
                    createdAt: new Date().toISOString()
                });

                showNotification('Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
            } catch (error) {
                const errorMessage = document.getElementById('error_message');
                errorMessage.textContent = `Ø®Ø·Ø§: ${error.message}`;
                errorMessage.style.display = 'block';
                showNotification(error.message, 'error');
            }
        }

        // ØªØ§Ø¨Ø¹ Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§
        function resetFields() {
            // Ø±ÛŒØ³Øª ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¯Ø³Ú©ØªØ§Ù¾
            document.getElementById('input_y1').value = '';
            document.getElementById('input_current_high').value = '';
            document.getElementById('input_y2').value = '';
            document.getElementById('input_current_low').value = '';
            // Ø±ÛŒØ³Øª ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
            document.getElementById('input_y1_mobile').value = '';
            document.getElementById('input_y2_mobile').value = '';
            document.getElementById('input_current_high_mobile').value = '';
            document.getElementById('input_current_low_mobile').value = '';
            const resultsList = document.getElementById('results_list');
            const errorMessage = document.getElementById('error_message');
            resultsList.innerHTML = '';
            errorMessage.style.display = 'none';
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…ÙˆØ¯Ø§Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø­Ø§Ø³Ø¨Ù‡
        function openEditCalculationModal(calculation) {
            // ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ÙÛŒÙ„Ø¯Ù‡Ø§
            document.getElementById('currencyPairSelect').value = calculation.currencyPair;
            document.getElementById('calculationDate').value = calculation.date;
            document.getElementById('input_y1').value = formatNumberBasedOnInput(calculation.inputY1, calculation.inputFormatY1);
            document.getElementById('input_y2').value = formatNumberBasedOnInput(calculation.inputY2, calculation.inputFormatY2);
            document.getElementById('input_current_high').value = formatNumberBasedOnInput(calculation.inputCurrentHigh, calculation.inputFormatY1);
            document.getElementById('input_current_low').value = formatNumberBasedOnInput(calculation.inputCurrentLow, calculation.inputFormatY2);
            
            // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
            document.getElementById('input_y1_mobile').value = formatNumberBasedOnInput(calculation.inputY1, calculation.inputFormatY1);
            document.getElementById('input_y2_mobile').value = formatNumberBasedOnInput(calculation.inputY2, calculation.inputFormatY2);
            document.getElementById('input_current_high_mobile').value = formatNumberBasedOnInput(calculation.inputCurrentHigh, calculation.inputFormatY1);
            document.getElementById('input_current_low_mobile').value = formatNumberBasedOnInput(calculation.inputCurrentLow, calculation.inputFormatY2);
            
            switchTab('calculator');
            showNotification('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù†Ø¯. Ù¾Ø³ Ø§Ø² ÙˆÛŒØ±Ø§ÛŒØ´ØŒ Ø¯Ú©Ù…Ù‡ "Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø°Ø®ÛŒØ±Ù‡" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.', 'success', 5000);
            currentEditId = calculation.id;
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÙˆÙ„ Ù…Ø­Ø§Ø³Ø¨Ø§Øª - Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù‡
        async function loadCalculationsTable() {
            try {
                const currencyPair = document.getElementById('filterCurrencyPair').value;
                const date = document.getElementById('filterDate').value;
                let calculations = await getAllFromDatabase(STORE_CALCULATIONS);
                
                if (currencyPair) {
                    calculations = calculations.filter(c => c.currencyPair === currencyPair);
                }
                
                // Ø±ÙØ¹ Ù…Ø´Ú©Ù„: ÙÙ‚Ø· Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ ØªØ§Ø±ÛŒØ® Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
                if (date) {
                    calculations = calculations.filter(c => c.date === date);
                } else {
                    calculations = [];
                }
                
                calculations.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const tableBody = document.getElementById('calculationsTableBody');
                const mobileCardsContainer = document.getElementById('mobileCardsContainer');
                const noDataMessage = document.getElementById('noDataMessage');
                
                tableBody.innerHTML = '';
                mobileCardsContainer.innerHTML = '';
                
                if (calculations.length === 0) {
                    noDataMessage.style.display = 'block';
                    return;
                }
                
                noDataMessage.style.display = 'none';
                
                calculations.forEach(calc => {
                    // ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø¬Ø¯ÙˆÙ„
                    const formattedY1 = formatNumberBasedOnInput(calc.inputY1, calc.inputFormatY1);
                    const formattedY2 = formatNumberBasedOnInput(calc.inputY2, calc.inputFormatY2);
                    const formattedCurrentHigh = formatNumberBasedOnInput(calc.inputCurrentHigh, calc.inputFormatY1);
                    const formattedCurrentLow = formatNumberBasedOnInput(calc.inputCurrentLow, calc.inputFormatY2);
                    const formattedResult1 = formatNumberBasedOnInput(calc.result1, calc.inputFormatY1);
                    const formattedResult2 = formatNumberBasedOnInput(calc.result2, calc.inputFormatY1);
                    const formattedResult3 = formatNumberBasedOnInput(calc.result3, calc.inputFormatY2);
                    const formattedResult4 = formatNumberBasedOnInput(calc.result4, calc.inputFormatY2);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="table-cell" data-copy="${formatDate(calc.date)}">${formatDate(calc.date)}</td>
                        <td class="table-cell" data-copy="${calc.currencyPair}">${calc.currencyPair}</td>
                        <td class="table-cell" data-copy="${formattedY1}">${formattedY1}</td>
                        <td class="table-cell" data-copy="${formattedY2}">${formattedY2}</td>
                        <td class="table-cell" data-copy="${formattedCurrentHigh}">${formattedCurrentHigh}</td>
                        <td class="table-cell" data-copy="${formattedCurrentLow}">${formattedCurrentLow}</td>
                        <td class="table-cell" data-copy="${formattedResult1}">${formattedResult1}</td>
                        <td class="table-cell" data-copy="${formattedResult2}">${formattedResult2}</td>
                        <td class="table-cell" data-copy="${formattedResult3}">${formattedResult3}</td>
                        <td class="table-cell" data-copy="${formattedResult4}">${formattedResult4}</td>
                        <td class="action-buttons">
                            <button class="action-btn edit-calculation" data-id="${calc.id}">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button class="action-btn danger delete-calculation" data-id="${calc.id}">Ø­Ø°Ù</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });

                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ø¯Ø± Ø¬Ø¯ÙˆÙ„
                document.querySelectorAll('#calculationsTableBody .table-cell').forEach(cell => {
                    cell.addEventListener('click', function(e) {
                        if (e.target.tagName === 'BUTTON') return; // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
                        copyToClipboard(this, this.dataset.copy);
                    });
                });

                calculations.forEach(calc => {
                    // ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
                    const formattedY1 = formatNumberBasedOnInput(calc.inputY1, calc.inputFormatY1);
                    const formattedY2 = formatNumberBasedOnInput(calc.inputY2, calc.inputFormatY2);
                    const formattedCurrentHigh = formatNumberBasedOnInput(calc.inputCurrentHigh, calc.inputFormatY1);
                    const formattedCurrentLow = formatNumberBasedOnInput(calc.inputCurrentLow, calc.inputFormatY2);
                    const formattedResult1 = formatNumberBasedOnInput(calc.result1, calc.inputFormatY1);
                    const formattedResult2 = formatNumberBasedOnInput(calc.result2, calc.inputFormatY1);
                    const formattedResult3 = formatNumberBasedOnInput(calc.result3, calc.inputFormatY2);
                    const formattedResult4 = formatNumberBasedOnInput(calc.result4, calc.inputFormatY2);
                    
                    const card = document.createElement('div');
                    card.className = 'calculation-card';
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="card-date">${formatDate(calc.date)}</div>
                            <div class="card-currency">${calc.currencyPair}</div>
                        </div>
                        <div class="card-content">
                            <div class="card-item">
                                <div class="card-label">Ø¹Ø¯Ø¯ Ø³Ù‚Ù</div>
                                <div class="card-value" data-value="${formattedY1}">${formattedY1}</div>
                            </div>
                            <div class="card-item">
                                <div class="card-label">Ø¹Ø¯Ø¯ Ú©Ù</div>
                                <div class="card-value" data-value="${formattedY2}">${formattedY2}</div>
                            </div>
                            <div class="card-item">
                                <div class="card-label">Ø³Ù‚Ù ÙØ¹Ù„ÛŒ</div>
                                <div class="card-value" data-value="${formattedCurrentHigh}">${formattedCurrentHigh}</div>
                            </div>
                            <div class="card-item">
                                <div class="card-label">Ú©Ù ÙØ¹Ù„ÛŒ</div>
                                <div class="card-value" data-value="${formattedCurrentLow}">${formattedCurrentLow}</div>
                            </div>
                            <div class="card-item">
                                <div class="card-label">ÙØ±Ù…ÙˆÙ„ Û±</div>
                                <div class="card-value" data-value="${formattedResult1}">${formattedResult1}</div>
                            </div>
                            <div class="card-item">
                                <div class="card-label">ÙØ±Ù…ÙˆÙ„ Û²</div>
                                <div class="card-value" data-value="${formattedResult2}">${formattedResult2}</div>
                            </div>
                            <div class="card-item">
                                <div class="card-label">ÙØ±Ù…ÙˆÙ„ Û³</div>
                                <div class="card-value" data-value="${formattedResult3}">${formattedResult3}</div>
                            </div>
                            <div class="card-item">
                                <div class="card-label">ÙØ±Ù…ÙˆÙ„ Û´</div>
                                <div class="card-value" data-value="${formattedResult4}">${formattedResult4}</div>
                            </div>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn edit-calculation" data-id="${calc.id}">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                            <button class="action-btn danger delete-calculation" data-id="${calc.id}">Ø­Ø°Ù</button>
                        </div>
                    `;
                    mobileCardsContainer.appendChild(card);
                });

                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ø¯Ø± Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
                document.querySelectorAll('#mobileCardsContainer .card-value').forEach(value => {
                    value.addEventListener('click', function(e) {
                        if (e.target.tagName === 'BUTTON') return; // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
                        copyToClipboard(this);
                    });
                });

                document.querySelectorAll('.edit-calculation').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const id = this.getAttribute('data-id');
                        try {
                            const calculations = await getAllFromDatabase(STORE_CALCULATIONS);
                            const calculation = calculations.find(c => c.id === parseInt(id));
                            if (calculation) {
                                openEditCalculationModal(calculation);
                            }
                        } catch (error) {
                            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡:', error);
                            showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡.', 'error');
                        }
                    });
                });

                document.querySelectorAll('.delete-calculation').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        showConfirmDeleteModal(
                            'Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ù†ÛŒØ³Øª.',
                            () => deleteCalculation(id)
                        );
                    });
                });
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÙˆÙ„ Ù…Ø­Ø§Ø³Ø¨Ø§Øª:', error);
            }
        }

        // ØªØ§Ø¨Ø¹ Ø­Ø°Ù Ù…Ø­Ø§Ø³Ø¨Ù‡
        async function deleteCalculation(id) {
            try {
                await deleteFromDatabase(STORE_CALCULATIONS, parseInt(id));
                await loadCalculationsTable();
                showNotification('Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù…Ø­Ø§Ø³Ø¨Ù‡:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù…Ø­Ø§Ø³Ø¨Ù‡.', 'error');
            }
        }

        // ØªØ§Ø¨Ø¹ Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ®
        async function deleteDataByDate() {
            const deleteBeforeDate = document.getElementById('deleteBeforeDate').value;
            if (!deleteBeforeDate) {
                showNotification('Ù„Ø·ÙØ§Ù‹ ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'warning');
                return;
            }
            try {
                const calculations = await getAllFromDatabase(STORE_CALCULATIONS);
                const oldCalculations = calculations.filter(c => c.date < deleteBeforeDate);
                if (oldCalculations.length === 0) {
                    showNotification('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø§ÛŒÙ† ØªØ§Ø±ÛŒØ® ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.', 'warning');
                    return;
                }
                if (confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù ${oldCalculations.length} Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚Ø¨Ù„ Ø§Ø² ØªØ§Ø±ÛŒØ® ${deleteBeforeDate} Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) {
                    for (const calc of oldCalculations) {
                        await deleteFromDatabase(STORE_CALCULATIONS, calc.id);
                    }
                    await loadCalculationsTable();
                    showNotification(`${oldCalculations.length} Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.`);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ®:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§.', 'error');
            }
        }

        // ØªØ§Ø¨Ø¹ Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆØ²
        async function deleteDataByDays() {
            const deleteDays = document.getElementById('deleteDays').value;
            if (!deleteDays || deleteDays < 1 || deleteDays > 365) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ø¹Ø¯Ø¯ÛŒ Ø¨ÛŒÙ† 1 ØªØ§ 365 ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.', 'warning');
                return;
            }
            try {
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - deleteDays);
                const cutoffDateString = cutoffDate.toISOString().split('T')[0];
                const calculations = await getAllFromDatabase(STORE_CALCULATIONS);
                const oldCalculations = calculations.filter(c => c.date < cutoffDateString);
                if (oldCalculations.length === 0) {
                    showNotification(`Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² ${deleteDays} Ø±ÙˆØ² ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.`, 'warning');
                    return;
                }
                if (confirm(`Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù ${oldCalculations.length} Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² ${deleteDays} Ø±ÙˆØ² Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ`)) {
                    for (const calc of oldCalculations) {
                        await deleteFromDatabase(STORE_CALCULATIONS, calc.id);
                    }
                    await loadCalculationsTable();
                    showNotification(`${oldCalculations.length} Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯.`);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ.', 'error');
            }
        }

        // ØªØ§Ø¨Ø¹ ÙØ±Ù…Øª ØªØ§Ø±ÛŒØ® Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ (Ù…ÛŒÙ„Ø§Ø¯ÛŒ)
        function formatDate(dateString) {
            return dateString;
        }

        // ØªØ§Ø¨Ø¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        async function backupData() {
            try {
                const calculations = await getAllFromDatabase(STORE_CALCULATIONS);
                const currencyPairs = await getAllFromDatabase(STORE_CURRENCY_PAIRS);
                const categories = await getAllFromDatabase(STORE_CATEGORIES);
                const settings = await getAllFromDatabase(STORE_SETTINGS);
                const backupData = {
                    calculations,
                    currencyPairs,
                    categories,
                    settings,
                    backupDate: new Date().toISOString(),
                    version: DB_VERSION
                };
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `calculator_pro_formula_4-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification('ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯');
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ.', 'error');
            }
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        async function restoreData() {
            const fileInput = document.getElementById('restoreFileInput');
            fileInput.click();
            fileInput.onchange = async function() {
                const file = this.files[0];
                if (!file) return;
                if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯.')) {
                    return;
                }
                try {
                    const fileText = await readFileAsText(file);
                    const backupData = JSON.parse(fileText);
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø®ØªØ§Ø± ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
                    if (!backupData.calculations || !backupData.currencyPairs || !backupData.categories) {
                        throw new Error('ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª. Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù†Ø§Ù‚Øµ Ø§Ø³Øª.');
                    }
                    await clearAllData();
                    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
                    for (const category of backupData.categories || []) {
                        await saveToDatabase(STORE_CATEGORIES, category);
                    }
                    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§
                    for (const pair of backupData.currencyPairs) {
                        await saveToDatabase(STORE_CURRENCY_PAIRS, pair);
                    }
                    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª
                    for (const calc of backupData.calculations) {
                        await saveToDatabase(STORE_CALCULATIONS, calc);
                    }
                    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                    for (const setting of backupData.settings || []) {
                        await saveToDatabase(STORE_SETTINGS, setting);
                    }
                    await loadCategories();
                    await loadCurrencyPairs();
                    await loadCalculationsTable();
                    showNotification('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯Ù†Ø¯.');
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:', error);
                    showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§: ' + error.message, 'error');
                }
                fileInput.value = '';
            };
        }

        // ØªØ§Ø¨Ø¹ Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ Ø¨Ù‡ ØµÙˆØ±Øª Ù…ØªÙ†
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(e);
                reader.readAsText(file);
            });
        }

        // ØªØ§Ø¨Ø¹ Ø­Ø°Ù ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        async function clearAllData() {
            try {
                const calculations = await getAllFromDatabase(STORE_CALCULATIONS);
                const currencyPairs = await getAllFromDatabase(STORE_CURRENCY_PAIRS);
                const categories = await getAllFromDatabase(STORE_CATEGORIES);
                for (const calc of calculations) {
                    await deleteFromDatabase(STORE_CALCULATIONS, calc.id);
                }
                for (const pair of currencyPairs) {
                    await deleteFromDatabase(STORE_CURRENCY_PAIRS, pair.id);
                }
                for (const category of categories) {
                    await deleteFromDatabase(STORE_CATEGORIES, category.id);
                }
                await loadCategories();
                await loadCurrencyPairs();
                await loadCalculationsTable();
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:', error);
                throw error;
            }
        }

        // ØªØ§Ø¨Ø¹ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        async function compareData() {
            const currencyPair = document.getElementById('comparisonCurrencyPair').value;
            const dateInputs = document.querySelectorAll('.comparison-date');
            const dates = Array.from(dateInputs).map(input => input.value).filter(date => date);
            if (!currencyPair) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ø¬ÙØª Ø§Ø±Ø² Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'warning');
                return;
            }
            if (dates.length === 0) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© ØªØ§Ø±ÛŒØ® Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.', 'warning');
                return;
            }
            try {
                const calculations = await getAllFromDatabase(STORE_CALCULATIONS);
                const comparisonResults = document.getElementById('comparisonResults');
                comparisonResults.innerHTML = '';
                let foundAnyData = false;
                for (const date of dates) {
                    const calc = calculations.find(c => 
                        c.currencyPair === currencyPair && c.date === date
                    );
                    const comparisonItem = document.createElement('div');
                    comparisonItem.className = 'comparison-item';
                    if (calc) {
                        foundAnyData = true;
                        // ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ù…Ù‚Ø§ÛŒØ³Ù‡
                        const formattedY1 = formatNumberBasedOnInput(calc.inputY1, calc.inputFormatY1);
                        const formattedY2 = formatNumberBasedOnInput(calc.inputY2, calc.inputFormatY2);
                        const formattedCurrentHigh = formatNumberBasedOnInput(calc.inputCurrentHigh, calc.inputFormatY1);
                        const formattedCurrentLow = formatNumberBasedOnInput(calc.inputCurrentLow, calc.inputFormatY2);
                        const formattedResult1 = formatNumberBasedOnInput(calc.result1, calc.inputFormatY1);
                        const formattedResult2 = formatNumberBasedOnInput(calc.result2, calc.inputFormatY1);
                        const formattedResult3 = formatNumberBasedOnInput(calc.result3, calc.inputFormatY2);
                        const formattedResult4 = formatNumberBasedOnInput(calc.result4, calc.inputFormatY2);
                        
                        comparisonItem.innerHTML = `
                            <h3>${formatDate(date)}</h3>
                            <p><strong>Ø¬ÙØª Ø§Ø±Ø²:</strong> ${calc.currencyPair}</p>
                            <p><strong>Ø¹Ø¯Ø¯ Ø³Ù‚Ù:</strong> ${formattedY1}</p>
                            <p><strong>Ø¹Ø¯Ø¯ Ú©Ù:</strong> ${formattedY2}</p>
                            <p><strong>Ø³Ù‚Ù ÙØ¹Ù„ÛŒ:</strong> ${formattedCurrentHigh}</p>
                            <p><strong>Ú©Ù ÙØ¹Ù„ÛŒ:</strong> ${formattedCurrentLow}</p>
                            <p><strong>ÙØ±Ù…ÙˆÙ„ Û±:</strong> ${formattedResult1}</p>
                            <p><strong>ÙØ±Ù…ÙˆÙ„ Û²:</strong> ${formattedResult2}</p>
                            <p><strong>ÙØ±Ù…ÙˆÙ„ Û³:</strong> ${formattedResult3}</p>
                            <p><strong>ÙØ±Ù…ÙˆÙ„ Û´:</strong> ${formattedResult4}</p>
                        `;
                    } else {
                        comparisonItem.innerHTML = `
                            <h3>${formatDate(date)}</h3>
                            <p>Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ§Ø±ÛŒØ® ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
                        `;
                    }
                    comparisonResults.appendChild(comparisonItem);
                }
                if (!foundAnyData) {
                    showNotification('Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯.', 'warning');
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§.', 'error');
            }
        }

        // ØªØ§Ø¨Ø¹ Ø§ÙØ²ÙˆØ¯Ù† ÙÛŒÙ„Ø¯ ØªØ§Ø±ÛŒØ® Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡
        function addComparisonDate() {
            const datesContainer = document.getElementById('comparisonDatesContainer');
            const dateRow = document.createElement('div');
            dateRow.className = 'comparison-date-row';
            dateRow.innerHTML = `
                <div class="comparison-date-input">
                    <input type="date" class="comparison-date">
                </div>
                <button type="button" class="remove-date-btn">Ã—</button>
            `;
            datesContainer.appendChild(dateRow);
            updateRemoveButtonsVisibility();
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø°Ù
        function updateRemoveButtonsVisibility() {
            const dateRows = document.querySelectorAll('.comparison-date-row');
            dateRows.forEach((row, index) => {
                const removeBtn = row.querySelector('.remove-date-btn');
                removeBtn.style.display = index === 0 ? 'none' : 'inline-block';
                const newRemoveBtn = removeBtn.cloneNode(true);
                removeBtn.parentNode.replaceChild(newRemoveBtn, removeBtn);
                newRemoveBtn.addEventListener('click', function() {
                    row.remove();
                    updateRemoveButtonsVisibility();
                });
            });
        }

        // ØªØ§Ø¨Ø¹ ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©/Ø±ÙˆØ´Ù†
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const themeToggle = document.getElementById('themeToggle');
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.textContent = 'â˜€ï¸';
                localStorage.setItem('theme_2', 'dark');
            } else {
                themeToggle.textContent = 'ğŸŒ™';
                localStorage.setItem('theme_2', 'light');
            }
        }

        // ØªØ§Ø¨Ø¹ ØªØºÛŒÛŒØ± ØªØ¨
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.mobile-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.querySelector(`.mobile-tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            // Ø¨Ø³ØªÙ† Ù…Ù†ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù¾Ø³ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ ØªØ¨
            if (window.innerWidth <= 768) {
                document.getElementById('mobileTabs').style.display = 'none';
                document.getElementById('mobileMenuToggle').classList.remove('active');
            }
            if (tabName === 'history') {
                loadCalculationsTable();
            }
        }

        // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´/Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
        function toggleMobileMenu() {
            const mobileTabs = document.getElementById('mobileTabs');
            const menuToggle = document.getElementById('mobileMenuToggle');
            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ù…Ù†Ùˆ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² computedStyle
            const isVisible = window.getComputedStyle(mobileTabs).display === 'flex';
            if (isVisible) {
                mobileTabs.style.display = 'none';
                menuToggle.classList.remove('active');
            } else {
                mobileTabs.style.display = 'flex';
                menuToggle.classList.add('active');
            }
        }

        // ØªØ§Ø¨Ø¹ Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ ØªØ£ÛŒÛŒØ¯ Ø­Ø°Ù
        function showConfirmDeleteModal(message, callback) {
            document.getElementById('confirmDeleteMessage').textContent = message;
            deleteCallback = callback;
            document.getElementById('confirmDeleteModal').style.display = 'flex';
        }

        // ØªØ§Ø¨Ø¹ Ø¨Ø³ØªÙ† Ù‡Ù…Ù‡ Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§
        function closeModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            currentEditId = null;
            currentEditType = null;
            deleteCallback = null;
            currentDeleteCategoryId = null;
        }

        // ØªØ§Ø¨Ø¹ ØªÙ†Ø¸ÛŒÙ… event listenerÙ‡Ø§
        function setupEventListeners() {
            // ØªØ¨â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            // ØªØ¨â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
            document.querySelectorAll('.mobile-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            // Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
            document.getElementById('mobileMenuToggle').addEventListener('click', toggleMobileMenu);
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨
            document.getElementById('calculateBtn').addEventListener('click', calculateAndSave);
            document.getElementById('resetBtn').addEventListener('click', resetFields);
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙØª Ø§Ø±Ø²Ù‡Ø§
            document.getElementById('addCurrencyPairBtn').addEventListener('click', addCurrencyPair);
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
            document.getElementById('addCategoryBtn').addEventListener('click', addCategory);
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡
            document.getElementById('compareDataBtn').addEventListener('click', compareData);
            document.getElementById('addDateBtn').addEventListener('click', addComparisonDate);
            document.getElementById('clearComparisonBtn').addEventListener('click', function() {
                document.getElementById('comparisonResults').innerHTML = '';
                document.getElementById('comparisonDatesContainer').innerHTML = `
                    <div class="comparison-date-row">
                        <div class="comparison-date-input">
                            <input type="date" class="comparison-date">
                        </div>
                        <button type="button" class="remove-date-btn" style="display: none;">Ã—</button>
                    </div>
                `;
                updateRemoveButtonsVisibility();
            });
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreDataBtn').addEventListener('click', restoreData);
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø°Ù Ø±Ú©ÙˆØ±Ø¯
            document.getElementById('deleteByDateBtn').addEventListener('click', deleteDataByDate);
            document.getElementById('deleteByDaysBtn').addEventListener('click', deleteDataByDays);
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„
            document.getElementById('saveCurrencyPairEditBtn').addEventListener('click', saveCurrencyPairEdit);
            document.getElementById('saveCategoryEditBtn').addEventListener('click', saveCategoryEdit);
            document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
                if (deleteCallback) {
                    deleteCallback();
                }
                closeModals();
            });
            document.getElementById('confirmCategoryDeleteBtn').addEventListener('click', deleteCategory);
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', closeModals);
            });
            // Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø¢Ù†
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    closeModals();
                }
            });
            // Ø§Ù…Ú©Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©Ù„ÛŒØ¯ Enter Ø¯Ø± ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ
            ['input_y1', 'input_current_high', 'input_y2', 'input_current_low', 
             'input_y1_mobile', 'input_y2_mobile', 'input_current_high_mobile', 'input_current_low_mobile'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            calculateAndSave();
                        }
                    });
                }
            });
            // ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©/Ø±ÙˆØ´Ù†
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø­Ø§Ù„Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
        if (localStorage.getItem('theme_2') === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('themeToggle').textContent = 'â˜€ï¸';
        }
    </script>
  <BR>
    <BR>
</body>
</html>
