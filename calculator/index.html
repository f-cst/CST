<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ماشین حساب</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* استایل سفارشی برای اسکرول بار */
    .display-scroll {
      scrollbar-width: thin;
      scrollbar-color: #4B5563 #1F2937;
    }
    
    .display-scroll::-webkit-scrollbar {
      height: 6px;
    }

    .display-scroll::-webkit-scrollbar-track {
      background: #1F2937;
      border-radius: 3px;
    }

    .display-scroll::-webkit-scrollbar-thumb {
      background: #4B5563;
      border-radius: 3px;
    }

    .display-scroll::-webkit-scrollbar-thumb:hover {
      background: #6B7280;
    }

    @keyframes pulse-glow {
      0% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
      50% { box-shadow: 0 0 15px rgba(59, 130, 246, 0.8); }
      100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
    }

    .active-input {
      animation: pulse-glow 2s infinite;
    }

    .title-box {
      color: white;
      text-align: center;
      padding: 16px;
      font-family: Vazirmatn, system-ui;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 24px;
      font-weight: bold;
      display: block;
      margin: 20px auto;
      width: fit-content;
      max-width: 90%;
      box-sizing: border-box;
    }

    .signature {
      color: white;
      text-align: center;
      padding: 16px;
      font-family: Vazirmatn, system-ui;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 14px;
      font-weight: 500;
      display: block;
      margin: 30px auto;
      width: fit-content;
      max-width: 90%;
      box-sizing: border-box;
    }

    @media only screen and (max-width: 768px) {
      .title-box { font-size: 20px; padding: 15px; }
      .signature { font-size: 14px; padding: 15px; }
    }

    @media only screen and (max-width: 480px) {
      .title-box { font-size: 18px; padding: 13px; }
      .signature { font-size: 12px; padding: 13px; }
    }
  </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

  <div class="bg-gray-800 p-6 rounded-lg border border-gray-700 w-full max-w-md">
    
    <!-- نمایشگر ماشین حساب -->
    <div class="bg-gray-900 p-3 rounded mb-4 border border-gray-600 calculator-display">
      <div id="calcHistory" class="text-right text-sm text-gray-400 h-6 overflow-x-auto display-scroll whitespace-nowrap mb-1"></div>
      <div id="calcDisplay" class="text-right text-2xl font-mono h-8 overflow-x-auto display-scroll whitespace-nowrap">0</div>
    </div>

    <!-- دکمه‌های ماشین حساب -->
    <div class="grid grid-cols-4 gap-2 mb-4">

      <!-- ردیف جدید: سه دکمه علمی اضافه شده -->
      <button class="calc-btn bg-indigo-600 hover:bg-indigo-700 p-2 rounded text-sm font-medium" data-value="sqrt">√x</button>
      <button class="calc-btn bg-indigo-600 hover:bg-indigo-700 p-2 rounded text-sm font-medium" data-value="square">x²</button>
      <button class="calc-btn bg-indigo-600 hover:bg-indigo-700 p-2 rounded text-sm font-medium" data-value="reciprocal">1/x</button>
      <button class="calc-btn bg-red-600 hover:bg-red-700 p-2 rounded" data-value="C">C</button>

      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="CE">CE</button>
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="backspace">
        <i class="fas fa-backspace"></i>
      </button>
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded text-sm" data-value="percent">%</button>
      <button class="calc-btn bg-amber-600 hover:bg-amber-700 p-2 rounded" data-value="/">÷</button>
      
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="7">7</button>
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="8">8</button>
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="9">9</button>
      <button class="calc-btn bg-amber-600 hover:bg-amber-700 p-2 rounded" data-value="*">×</button>
      
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="4">4</button>
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="5">5</button>
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="6">6</button>
      <button class="calc-btn bg-amber-600 hover:bg-amber-700 p-2 rounded" data-value="-">−</button>
      
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="1">1</button>
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="2">2</button>
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value="3">3</button>
      <button class="calc-btn bg-amber-600 hover:bg-amber-700 p-2 rounded" data-value="+">+</button>
      
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded col-span-2" data-value="0">0</button>
      <button class="calc-btn bg-gray-700 hover:bg-gray-600 p-2 rounded" data-value=".">.</button>
      <button class="calc-btn bg-green-600 hover:bg-green-700 p-2 rounded" data-value="=">=</button>
    </div>

    <!-- تاریخچه محاسبات -->
    <div class="bg-gray-700 p-3 rounded">
      <h3 class="font-semibold mb-2 flex justify-between items-center">
        <span>تاریخچه محاسبات</span>
        <button id="clearHistory" class="text-xs bg-red-600 hover:bg-red-700 px-2 py-1 rounded">پاک کردن</button>
      </h3>
      <div id="historyList" class="max-h-32 overflow-y-auto text-sm space-y-1"></div>
    </div>
  </div>

  <script>
    let currentInput = '0';
    let previousInput = '';
    let operation = null;
    let resetInput = false;
    let calculationHistory = [];

    const calcDisplay = document.getElementById('calcDisplay');
    const calcHistory = document.getElementById('calcHistory');
    const historyList = document.getElementById('historyList');

    function updateDisplay() {
      calcDisplay.textContent = currentInput;
      calcHistory.textContent = previousInput + (operation ? ` ${getOperationSymbol(operation)}` : '');
    }

    function getOperationSymbol(op) {
      const symbols = { '+': '+', '-': '−', '*': '×', '/': '÷' };
      return symbols[op] || op;
    }

    function addToHistory(calculation) {
      calculationHistory.unshift(calculation);
      if (calculationHistory.length > 10) calculationHistory.pop();
      updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
      historyList.innerHTML = '';
      calculationHistory.forEach(item => {
        const div = document.createElement('div');
        div.className = 'border-b border-gray-600 pb-1';
        div.textContent = item;
        historyList.appendChild(div);
      });
    }

    function calculate() {
      let result;
      const prev = parseFloat(previousInput);
      const current = parseFloat(currentInput);

      if (isNaN(prev) || isNaN(current)) return;

      switch(operation) {
        case '+': result = prev + current; break;
        case '-': result = prev - current; break;
        case '*': result = prev * current; break;
        case '/': result = current === 0 ? 'خطا' : prev / current; break;
        default: return;
      }

      const calcText = `${previousInput} ${getOperationSymbol(operation)} ${currentInput} = ${result}`;
      addToHistory(calcText);

      currentInput = result.toString();
      operation = null;
      previousInput = '';
      resetInput = true;
      updateDisplay();
    }

    // ← سه قابلیت جدید اینجا اضافه شدن
    function applyScientificOperation(op) {
      const num = parseFloat(currentInput);
      if (isNaN(num)) return;

      let result, text;
      if (op === 'sqrt') {
        if (num < 0) { currentInput = 'خطا'; updateDisplay(); return; }
        result = Math.sqrt(num);
        text = `√(${currentInput}) = ${result}`;
      } else if (op === 'square') {
        result = num * num;
        text = `sqr(${currentInput}) = ${result}`;
      } else if (op === 'reciprocal') {
        if (num === 0) { currentInput = 'خطا'; updateDisplay(); return; }
        result = 1 / num;
        text = `1/(${currentInput}) = ${result}`;
      }

      addToHistory(text);
      currentInput = result.toString();
      resetInput = true;
      updateDisplay();
    }

    document.querySelectorAll('.calc-btn').forEach(button => {
      button.addEventListener('click', () => {
        const value = button.getAttribute('data-value');

        if (value === 'sqrt' || value === 'square' || value === 'reciprocal') {
          applyScientificOperation(value);
          return;
        }

        if (value === 'C') {
          currentInput = '0';
          previousInput = '';
          operation = null;
        } else if (value === 'CE') {
          currentInput = '0';
        } else if (value === 'backspace') {
          currentInput = currentInput.length > 1 ? currentInput.slice(0, -1) : '0';
        } else if (value === '=') {
          if (operation && previousInput) calculate();
        } else if (['+', '-', '*', '/'].includes(value)) {
          if (previousInput === '') {
            previousInput = currentInput;
          } else if (operation) {
            calculate();
          }
          operation = value;
          resetInput = true;
        } else {
          if (resetInput || currentInput === '0') currentInput = value;
          else currentInput += value;
          resetInput = false;
        }

        updateDisplay();
      });
    });

    document.getElementById('clearHistory').addEventListener('click', () => {
      calculationHistory = [];
      updateHistoryDisplay();
    });

    // پشتیبانی کامل کیبورد (بدون تغییر)
    document.addEventListener('keydown', (e) => {
      const key = e.key;
      if (key >= '0' && key <= '9' || key === '.') {
        document.querySelector(`.calc-btn[data-value="${key === '.' ? '.' : key}"]`)?.click();
      } else if (['+', '-', '*', '/'].includes(key)) {
        document.querySelector(`.calc-btn[data-value="${key}"]`)?.click();
      } else if (key === 'Enter' || key === '=') {
        e.preventDefault();
        document.querySelector('.calc-btn[data-value="="]')?.click();
      } else if (key === 'Escape') {
        document.querySelector('.calc-btn[data-value="C"]')?.click();
      } else if (key === 'Backspace') {
        e.preventDefault();
        document.querySelector('.calc-btn[data-value="backspace"]')?.click();
      }
    });

    updateDisplay();
  </script>

  <div class="signature">
    طراحی و ساخت توسط ⦙ سعید شیخ احمد صفاری
  </div>
  <br><br>
</body>
</html>
