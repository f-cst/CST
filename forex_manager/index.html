<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم مدیریت جفت ارزها - فارکس</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
        :root {
            --primary-color: #2a5298;
            --secondary-color: #1e3c72;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --text-color: #333;
            --border-color: #e0e0e0;
            --bg-light: #f8f9fa;
            --bg-dark: #1a1a1a;
            --text-dark: #f0f0f0;
            --card-bg: #ffffff;
            --header-bg: #ffffff;
        }

        .dark-mode {
            --primary-color: #4a7bd9;
            --secondary-color: #2d2d2d;
            --text-color: #f0f0f0;
            --border-color: #555;
            --bg-light: #2d2d2d;
            --card-bg: #383838;
            --header-bg: #1e1e1e;
            --bg-dark: #121212;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        
        body {
            background: var(--bg-light);
            color: var(--text-color);
            min-height: 100vh;
            padding: 15px;
            line-height: 1.6;
            font-size: 14px; /* کاهش سایز فونت پایه */
        }

        .dark-mode body {
            background: var(--bg-dark);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* استایل شیشه‌ای برای هدر */
        .header-glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 16px;
            padding: 20px 30px;
            box-shadow: 
                0 8px 32px 0 rgba(31, 38, 135, 0.2),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }

        /* افکت شیشه‌ای برای حالت تاریک */
        .dark-mode .header-glass {
            background: rgba(30, 30, 30, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px 0 rgba(0, 0, 0, 0.3),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
        }

        /* دکمه‌های شیشه‌ای */
        .glass-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 10px 18px;
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 4px 15px 0 rgba(31, 38, 135, 0.1),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 
                0 6px 20px 0 rgba(31, 38, 135, 0.2),
                inset 0 1px 0 0 rgba(255, 255, 255, 0.3);
        }

        /* عنوان در باکس شیشه‌ای */
        .header-glass h1 {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 1.8rem;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* افکت نور پس‌زمینه */
        .header-glass::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            z-index: -1;
        }

        header {
            text-align: center;
            color: var(--text-color);
        }
        
        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .tabs {
            display: flex;
            background: var(--header-bg);
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .tab {
            padding: 12px 15px; /* کاهش padding */
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
            position: relative;
            color: var(--text-color);
            font-size: 0.9rem; /* کاهش سایز فونت */
        }
        
        .tab.active {
            background: var(--primary-color);
            color: white;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: white;
        }
        
        .hamburger-menu {
            display: none;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 6px;
        }
        
        .mobile-tabs {
            display: none;
            flex-direction: column;
            background: var(--header-bg);
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 5px;
            border-radius: 8px;
        }
        
        .mobile-tab {
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        .mobile-tab.active {
            background: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-height: 500px;
            color: var(--text-color);
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* استایل برای مدیریت دسته‌بندی‌ها */
        .categories-management {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.2rem; /* کاهش سایز */
            margin-bottom: 12px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 6px;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem; /* کاهش سایز فونت */
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--secondary-color);
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        .btn-danger {
            background: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-info {
            background: var(--info-color);
            color: white;
        }
        
        .btn-info:hover {
            background: #2980b9;
        }
        
        /* استایل بهبود یافته برای کارت‌های ارز */
        .currency-category {
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            background: var(--card-bg);
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: var(--bg-light);
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }
        
        .category-title {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1rem; /* کاهش سایز */
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .category-title i {
            transition: transform 0.3s;
            font-size: 0.9rem;
        }
        
        .category-title.collapsed i {
            transform: rotate(-90deg);
        }
        
        .category-actions {
            display: flex;
            gap: 6px;
        }
        
        .category-action-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.3s;
            color: var(--text-color);
        }
        
        .edit-btn {
            color: var(--primary-color);
        }
        
        .edit-btn:hover {
            background: rgba(42, 82, 152, 0.1);
        }
        
        .delete-btn {
            color: var(--danger-color);
        }
        
        .delete-btn:hover {
            background: rgba(231, 76, 60, 0.1);
        }
        
        .currency-list {
            padding: 8px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 6px;
            min-height: 45px;
        }

        .currency-list.collapsed {
            display: none;
        }

        /* استایل برای قابلیت Drag & Drop */
        .currency-list.drag-over {
            background: rgba(42, 82, 152, 0.1);
            border: 2px dashed var(--primary-color);
            border-radius: 6px;
        }
        
        /* کارت ارز بهبود یافته - نمایش فشرده */
        .currency-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-light);
            border-radius: 6px;
            padding: 6px 10px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            min-height: 45px;
            position: relative;
            cursor: grab;
        }
        
        .currency-card:active {
            cursor: grabbing;
        }
        
        .currency-card.dragging {
            opacity: 0.5;
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .currency-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-color: var(--primary-color);
        }
        
        .currency-name {
            font-weight: 700;
            color: var(--text-color);
            font-size: 0.9rem;
            min-width: 70px;
        }
        
        .currency-actions {
            display: flex;
            gap: 4px;
            margin-left: 8px;
        }
        
        .currency-action-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 3px;
            border-radius: 3px;
            transition: all 0.3s;
            color: var(--text-color);
        }
        
        .currency-action-btn:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        .move-btn {
            cursor: move;
        }
        
        /* استایل برای ماشین حساب */
        .calculator {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border 0.3s;
            background: var(--card-bg);
            color: var(--text-color);
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(42, 82, 152, 0.2);
        }
        
        .buttons {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            grid-column: 1 / -1;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: var(--bg-light);
            border-radius: 6px;
            border-right: 4px solid var(--primary-color);
            grid-column: 1 / -1;
        }
        
        .result h3 {
            margin-bottom: 12px;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        
        /* استایل برای تب تاریخچه */
        .history-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .history-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 12px;
        }
        
        .history-item {
            background: var(--bg-light);
            border-radius: 6px;
            padding: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }
        
        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .history-currency {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 0.95rem;
        }
        
        .history-date {
            color: var(--text-color);
            font-size: 0.85rem;
        }
        
        .history-details {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .history-detail {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
        }
        
        .history-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 8px;
            gap: 8px;
        }
        
        /* استایل برای تب حذف رکورد */
        .delete-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .delete-option {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        
        .delete-option h3 {
            margin-bottom: 12px;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .delete-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        /* استایل برای تب مدیریت داده */
        .data-management {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .data-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .data-action {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        
        /* مودال‌ها */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        
        .modal-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            color: var(--text-color);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal h2 {
            margin-bottom: 12px;
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
            font-size: 1.2rem;
        }
        
        .modal-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            justify-content: flex-end;
        }
        
        /* استایل‌های فرم */
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .form-row {
            display: flex;
            gap: 12px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        /* رسپانسیو - بهبود یافته */
        @media (max-width: 1200px) {
            .currency-list {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
            
            .history-list {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }
        
        /* ویرایش شده: تبلت - نمایش دو ستونه مانند دسکتاپ */
        @media (max-width: 992px) and (min-width: 769px) {
            .calculator-grid {
                grid-template-columns: 1fr 1fr; /* دو ستونه در تبلت */
                gap: 12px;
            }
            
            .currency-list {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .history-list {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }
        
        /* ویرایش شده: فقط برای موبایل تک ستونه */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 13px;
            }
            
            .header-glass {
                padding: 15px 20px;
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .header-glass h1 {
                font-size: 1.5rem;
            }
            
            .header-controls {
                width: 100%;
                justify-content: center;
            }
            
            .glass-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .tabs {
                display: none;
            }
            
            .hamburger-menu {
                display: block;
            }
            
            .mobile-tabs.active {
                display: flex;
            }
            
            .currency-list {
                grid-template-columns: 1fr;
            }
            
            .currency-card {
                padding: 6px 8px;
                align-items: center;
                gap: 6px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                justify-content: center;
                width: 100%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .calculator-grid {
                grid-template-columns: 1fr; /* فقط در موبایل تک ستونه */
            }
            
            .history-list {
                grid-template-columns: 1fr;
            }
            
            .history-filters {
                flex-direction: column;
            }
            
            .history-actions {
                justify-content: center;
            }
            
            .modal-content {
                padding: 15px;
                margin: 10px;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 576px) {
            body {
                padding: 8px;
                font-size: 12px;
            }
            
            .header-glass {
                padding: 12px 15px;
                border-radius: 12px;
            }
            
            .header-glass h1 {
                font-size: 1.3rem;
            }
            
            .glass-btn {
                padding: 7px 12px;
                font-size: 0.85rem;
            }
            
            .category-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .category-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .tab-content {
                padding: 15px;
            }
            
            .history-item {
                padding: 10px;
            }
            
            .history-detail {
                flex-direction: column;
                gap: 2px;
            }
            
            .modal-content {
                padding: 12px;
            }
            
            .pip-calculator-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-lot-buttons {
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .currency-name {
                min-width: 60px;
                font-size: 0.85rem;
            }
            
            .currency-actions {
                margin-left: 5px;
            }
            
            .history-header {
                flex-direction: column;
                gap: 5px;
            }
            
            .history-actions {
                flex-direction: column;
            }
            
            .history-actions .btn {
                width: 100%;
            }
        }
        
        @media (max-width: 360px) {
            body {
                padding: 5px;
            }
            
            .header-glass {
                padding: 10px 12px;
            }
            
            .header-glass h1 {
                font-size: 1.2rem;
            }
            
            .tab-content {
                padding: 10px;
            }
            
            .category-header {
                padding: 8px 10px;
            }
            
            .currency-card {
                padding: 5px 8px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .glass-btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
        }

        .empty-state {
            text-align: center;
            padding: 25px;
            color: var(--text-color);
        }
        
        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 12px;
            color: var(--border-color);
        }
        
        .info-badge {
            background: var(--info-color);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.65rem;
            margin-right: 4px;
        }

        .profit {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .loss {
            color: var(--danger-color);
            font-weight: bold;
        }

        .notes-section {
            margin-top: 15px;
            grid-column: 1 / -1;
        }

        .pip-value-info {
            font-size: 0.8rem;
            color: var(--info-color);
            margin-top: 4px;
        }

        .currency-type-badge {
            background: var(--warning-color);
            color: white;
            padding: 2px 5px;
            border-radius: 4px;
            font-size: 0.65rem;
            margin-right: 4px;
        }

        /* استایل‌های ماشین حساب ارزش پیپ */
        .pip-calculator-container {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 8px;
            margin-top: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .pip-calculator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary-color);
            flex-wrap: wrap;
            gap: 10px;
        }

        .pip-calculator-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            font-weight: bold;
        }

        .pip-calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .pip-result-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .pip-result-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 8px 0;
        }

        .pip-result-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .quick-lot-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .quick-lot-btn {
            padding: 6px 12px;
            background: var(--info-color);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .quick-lot-btn:hover {
            background: var(--primary-color);
            transform: translateY(-2px);
        }

        .pip-explanation {
            margin-top: 15px;
            padding: 12px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 6px;
            border-right: 4px solid var(--info-color);
            font-size: 0.85rem;
        }

        .pip-explanation h4 {
            color: var(--info-color);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        /* استایل برای اعلان خودکار */
        .auto-alert {
            position: fixed;
            top: 15px;
            right: 15px;
            background: var(--success-color);
            color: white;
            padding: 12px 15px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 8px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            max-width: 300px;
            font-size: 0.9rem;
        }

        .auto-alert.show {
            transform: translateX(0);
        }

        .auto-alert.error {
            background: var(--danger-color);
        }

        .auto-alert.warning {
            background: var(--warning-color);
        }
        
        .signature {
            text-align: center;
            padding: 10px 20px;
            font-family: Vazirmatn, system-ui;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            font-size: 14px;
            font-weight: 500;
            display: block;
            margin: 30px auto;
            width: fit-content;
            color: var(--text-color);
        }
        
        .dark-mode .signature {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-dark);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>سیستم مدیریت جفت ارزها - فارکس</h1>
            <div class="header-controls">
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i> حالت تاریک
                </button>
                <button class="hamburger-menu" id="hamburgerMenu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="calculator">ماشین حساب فارکس</div>
            <div class="tab" data-tab="history">تاریخچه معاملات</div>
            <div class="tab" data-tab="currency-management">مدیریت جفت ارزها</div>
            <div class="tab" data-tab="delete-records">حذف رکوردها</div>
            <div class="tab" data-tab="data-management">مدیریت داده</div>
        </div>
        
        <div class="mobile-tabs" id="mobileTabs">
            <div class="mobile-tab active" data-tab="calculator">ماشین حساب فارکس</div>
            <div class="mobile-tab" data-tab="history">تاریخچه معاملات</div>
            <div class="mobile-tab" data-tab="currency-management">مدیریت جفت ارزها</div>
            <div class="mobile-tab" data-tab="delete-records">حذف رکوردها</div>
            <div class="mobile-tab" data-tab="data-management">مدیریت داده</div>
        </div>
        
        <div class="tab-content active" id="calculator">
            <!-- ماشین حساب اصلی -->
            <div class="calculator">
                <h2 class="section-title">ماشین حساب محاسبه سود/ضرر</h2>
                <div class="calculator-grid">
                    <div class="input-group">
                        <label for="currency-pair-calc">جفت ارز</label>
                        <select id="currency-pair-calc">
                            <option value="">انتخاب جفت ارز</option>
                        </select>
                        <div class="pip-value-info" id="currency-type-info"></div>
                    </div>
                    <div class="input-group">
                        <label for="trade-date">تاریخ معامله</label>
                        <input type="date" id="trade-date">
                    </div>
                    <div class="input-group">
                        <label for="lot-size">حجم معامله (لات)</label>
                        <input type="number" id="lot-size" step="0.01" placeholder="مثال: 0.1" value="0.1">
                    </div>
                    <div class="input-group">
                        <label for="entry-price">قیمت ورود</label>
                        <input type="number" id="entry-price" step="0.00001" placeholder="مثال: 1.1250">
                    </div>
                    <div class="input-group">
                        <label for="take-profit">نقطه تارگت (Take Profit)</label>
                        <input type="number" id="take-profit" step="0.00001" placeholder="مثال: 1.1350">
                    </div>
                    <div class="input-group">
                        <label for="stop-loss">نقطه استاپ لاس (Stop Loss)</label>
                        <input type="number" id="stop-loss" step="0.00001" placeholder="مثال: 1.1200">
                    </div>
                    <div class="input-group">
                        <label for="exit-price">قیمت خروج واقعی</label>
                        <input type="number" id="exit-price" step="0.00001" placeholder="مثال: 1.1300">
                    </div>
                    <div class="input-group">
                        <label for="position-type">نوع پوزیشن</label>
                        <select id="position-type">
                            <option value="buy">خرید (Long)</option>
                            <option value="sell">فروش (Short)</option>
                        </select>
                    </div>
                    
                    <div class="notes-section">
                        <div class="input-group">
                            <label for="trade-notes">یادداشت معامله (ژورنال نویسی)</label>
                            <textarea id="trade-notes" placeholder="دلیل سود یا ضرر، تحلیل بازار، احساسات و..."></textarea>
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button class="btn btn-primary" id="calculate">
                            <i class="fas fa-calculator"></i> محاسبه و ذخیره
                        </button>
                        <button class="btn btn-warning" id="reset">
                            <i class="fas fa-redo"></i> ریست
                        </button>
                    </div>
                    
                    <div class="result" id="result" style="display: none;">
                        <h3>نتایج محاسبه</h3>
                        <div class="result-item">
                            <span>از نقطه ورود تا تارگت (پیپ):</span>
                            <span id="target-pips">0</span>
                        </div>
                        <div class="result-item">
                            <span>از نقطه ورود تا استاپ لاس (پیپ):</span>
                            <span id="stop-pips">0</span>
                        </div>
                        <div class="result-item">
                            <span>ریسک به ریوارد:</span>
                            <span id="risk-reward">0</span>
                        </div>
                    </div>
                </div>				
            </div>

            <!-- ماشین حساب ارزش پیپ -->
            <div class="pip-calculator-container">
                <div class="pip-calculator-header">
                    <div class="pip-calculator-title">
                        <i class="fas fa-calculator"></i> ماشین حساب ارزش پیپ
                    </div>
                    <div class="pip-value-info">
                        ارزش پیپ بر اساس جفت ارز و حجم معامله محاسبه می‌شود
                    </div>
                </div>

                <div class="pip-calculator-grid">
                    <div class="input-group">
                        <label for="pip-currency">جفت ارز</label>
                        <select id="pip-currency">
                            <option value="">انتخاب جفت ارز</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="pip-lot-size">حجم معامله (لات)</label>
                        <input type="number" id="pip-lot-size" step="0.01" placeholder="مثال: 0.1" value="0.1">
                        <div class="quick-lot-buttons">
                            <button class="quick-lot-btn" data-lot="0.01">0.01</button>
                            <button class="quick-lot-btn" data-lot="0.1">0.1</button>
                            <button class="quick-lot-btn" data-lot="0.5">0.5</button>
                            <button class="quick-lot-btn" data-lot="1">1</button>
                            <button class="quick-lot-btn" data-lot="2">2</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="pip-price">قیمت جفت ارز</label>
                        <input type="number" id="pip-price" step="0.00001" placeholder="مثال: 1.1250" value="1.1250">
                    </div>
                    
                    <div class="input-group">
                        <label for="account-currency">ارز حساب</label>
                        <select id="account-currency">
                            <option value="USD">دلار آمریکا (USD)</option>
                            <option value="EUR">یورو (EUR)</option>
                            <option value="GBP">پوند (GBP)</option>
                            <option value="JPY">ین ژاپن (JPY)</option>
                            <option value="CAD">دلار کانادا (CAD)</option>
                            <option value="AUD">دلار استرالیا (AUD)</option>
                        </select>
                    </div>
                </div>

                <div class="buttons">
                    <button class="btn btn-info" id="calculate-pip-value">
                        <i class="fas fa-calculator"></i> محاسبه ارزش پیپ
                    </button>
                    <button class="btn btn-warning" id="reset-pip-calculator">
                        <i class="fas fa-redo"></i> ریست
                    </button>
                </div>

                <div class="result" id="pip-result" style="display: none;">
                    <h3>نتایج محاسبه ارزش پیپ</h3>
                    <div class="pip-calculator-grid">
                        <div class="pip-result-card">
                            <div class="pip-result-label">ارزش هر پیپ</div>
                            <div class="pip-result-value" id="calculated-pip-value">0</div>
                            <div class="pip-result-label" id="pip-currency-display">USD</div>
                        </div>
                        
                        <div class="pip-result-card">
                            <div class="pip-result-label">ارزش 10 پیپ</div>
                            <div class="pip-result-value" id="calculated-10pip-value">0</div>
                            <div class="pip-result-label" id="pip10-currency-display">USD</div>
                        </div>
                        
                        <div class="pip-result-card">
                            <div class="pip-result-label">ارزش 50 پیپ</div>
                            <div class="pip-result-value" id="calculated-50pip-value">0</div>
                            <div class="pip-result-label" id="pip50-currency-display">USD</div>
                        </div>
                    </div>
                </div>

                <div class="pip-explanation">
                    <h4><i class="fas fa-info-circle"></i> نحوه محاسبه ارزش پیپ:</h4>
                    <p>• برای جفت ارزهای استاندارد (EURUSD, GBPUSD و ...): ارزش پیپ = 0.0001 × حجم معامله × 100,000</p>
                    <p>• برای جفت ارزهای JPY (USDJPY, EURJPY و ...): ارزش پیپ = 0.01 × حجم معامله × 100,000 ÷ قیمت</p>
                    <p>• حجم معامله 1 لات استاندارد = 100,000 واحد از ارز پایه</p>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="history">
            <h2 class="section-title">تاریخچه معاملات</h2>
            
            <div class="history-filters">
                <div class="input-group">
                    <label for="filter-currency">فیلتر بر اساس جفت ارز</label>
                    <select id="filter-currency">
                        <option value="all">همه جفت ارزها</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="filter-date">فیلتر بر اساس تاریخ</label>
                    <input type="date" id="filter-date">
                </div>
                
                <div class="input-group">
                    <label for="filter-result">فیلتر بر اساس نتیجه</label>
                    <select id="filter-result">
                        <option value="all">همه نتایج</option>
                        <option value="profit">سودده</option>
                        <option value="loss">ضررده</option>
                        <option value="pending">در انتظار</option>
                    </select>
                </div>
                
                <div class="history-actions">
                    <button class="btn btn-primary" id="apply-filter">
                        <i class="fas fa-filter"></i> اعمال فیلتر
                    </button>
                    <button class="btn btn-warning" id="clear-filter">
                        <i class="fas fa-times"></i> حذف فیلتر
                    </button>
                </div>
            </div>
            
            <div class="history-list" id="history-list">
                <!-- تاریخچه معاملات به صورت داینامیک لود می‌شود -->
            </div>
        </div>
        
        <div class="tab-content" id="currency-management">
            <h2 class="section-title">مدیریت جفت ارزها</h2>
            
            <div class="action-buttons">
                <button class="btn btn-primary" id="add-category">
                    <i class="fas fa-plus"></i> افزودن دسته جدید
                </button>
                <button class="btn btn-success" id="add-currency">
                    <i class="fas fa-plus-circle"></i> افزودن جفت ارز جدید
                </button>
                <button class="btn btn-info" id="save-changes">
                    <i class="fas fa-save"></i> ذخیره تغییرات
                </button>
            </div>
            
            <div class="categories-management" id="categories-management">
                <!-- دسته‌بندی‌ها و جفت ارزها به صورت داینامیک لود می‌شوند -->
            </div>
        </div>
        
        <div class="tab-content" id="delete-records">
            <h2 class="section-title">حذف رکوردها</h2>
            
            <div class="delete-options">
                <div class="delete-option">
                    <h3><i class="fas fa-trash-alt"></i> حذف تاریخچه معاملات</h3>
                    <p>با این عمل تمام تاریخچه معاملات شما حذف خواهد شد و قابل بازگشت نیست.</p>
                    <div class="delete-actions">
                        <button class="btn btn-danger" id="delete-history">
                            <i class="fas fa-trash"></i> حذف تاریخچه
                        </button>
                    </div>
                </div>
                
                <div class="delete-option">
                    <h3><i class="fas fa-trash-alt"></i> حذف جفت ارزها</h3>
                    <p>با این عمل تمام جفت ارزها و دسته‌بندی‌ها حذف خواهند شد.</p>
                    <div class="delete-actions">
                        <button class="btn btn-danger" id="delete-currencies">
                            <i class="fas fa-trash"></i> حذف جفت ارزها
                        </button>
                    </div>
                </div>
                
                <div class="delete-option">
                    <h3><i class="fas fa-trash-alt"></i> حذف همه داده‌ها</h3>
                    <p>با این عمل تمام داده‌های سیستم (تاریخچه، جفت ارزها و تنظیمات) حذف خواهند شد.</p>
                    <div class="delete-actions">
                        <button class="btn btn-danger" id="delete-all">
                            <i class="fas fa-trash"></i> حذف همه داده‌ها
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="data-management">
            <h2 class="section-title">مدیریت داده</h2>
            
            <div class="data-management">
                <div class="data-actions">
                    <div class="data-action">
                        <h3><i class="fas fa-download"></i> پشتیبان‌گیری از داده‌ها</h3>
                        <p>از تمام داده‌های سیستم شامل تاریخچه معاملات، جفت ارزها و تنظیمات یک فایل پشتیبان تهیه کنید.</p>
                        <button class="btn btn-success" id="backup-data">
                            <i class="fas fa-download"></i> دانلود فایل پشتیبان
                        </button>
                    </div>
                    
                    <div class="data-action">
                        <h3><i class="fas fa-upload"></i> بازیابی داده‌ها</h3>
                        <p>داده‌های سیستم را از یک فایل پشتیبان قبلی بازیابی کنید.</p>
                        <div class="input-group">
                            <label for="backup-file">انتخاب فایل پشتیبان</label>
                            <input type="file" id="backup-file" accept=".json">
                        </div>
                        <button class="btn btn-primary" id="restore-data">
                            <i class="fas fa-upload"></i> بازیابی داده‌ها
                        </button>
                    </div>
                    
                    <div class="data-action">
                        <h3><i class="fas fa-chart-bar"></i> آمار و گزارشات</h3>
                        <p>مشاهده آمار و گزارشات از عملکرد معاملاتی شما.</p>
                        <button class="btn btn-info" id="show-stats">
                            <i class="fas fa-chart-pie"></i> مشاهده آمار
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- مودال‌ها -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <h2 id="categoryModalTitle">افزودن دسته جدید</h2>
            <div class="form-group">
                <label for="category-name">نام دسته</label>
                <input type="text" id="category-name" placeholder="مثال: جفت ارزهای اصلی">
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="saveCategory">ذخیره</button>
                <button class="btn btn-warning" id="cancelCategory">لغو</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="currencyModal">
        <div class="modal-content">
            <h2 id="currencyModalTitle">افزودن جفت ارز جدید</h2>
            <div class="form-group">
                <label for="currency-name">نام جفت ارز</label>
                <input type="text" id="currency-name" placeholder="مثال: EURUSD">
            </div>
            <div class="form-group">
                <label for="currency-category">دسته‌بندی</label>
                <select id="currency-category"></select>
            </div>
            <div class="form-group">
                <label for="currency-type">نوع جفت ارز</label>
                <select id="currency-type">
                    <option value="standard">استاندارد (مثل EURUSD)</option>
                    <option value="jpy">دارای ین ژاپن (مثل USDJPY)</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="saveCurrency">ذخیره</button>
                <button class="btn btn-warning" id="cancelCurrency">لغو</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="deleteCategoryModal">
        <div class="modal-content">
            <h2>حذف دسته‌بندی</h2>
            <div class="form-group">
                <p id="delete-category-message">آیا می‌خواهید این دسته‌بندی را حذف کنید؟</p>
            </div>
            <div class="form-group" id="move-currencies-section" style="display: none;">
                <label for="move-to-category">انتقال جفت ارزها به دسته‌بندی:</label>
                <select id="move-to-category"></select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger" id="confirmDeleteCategory">حذف</button>
                <button class="btn btn-warning" id="cancelDeleteCategory">لغو</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="editCurrencyModal">
        <div class="modal-content">
            <h2>ویرایش جفت ارز</h2>
            <div class="form-group">
                <label for="edit-currency-name">نام جفت ارز</label>
                <input type="text" id="edit-currency-name" placeholder="مثال: EURUSD">
            </div>
            <div class="form-group">
                <label for="edit-currency-category">دسته‌بندی</label>
                <select id="edit-currency-category"></select>
            </div>
            <div class="form-group">
                <label for="edit-currency-type">نوع جفت ارز</label>
                <select id="edit-currency-type">
                    <option value="standard">استاندارد (مثل EURUSD)</option>
                    <option value="jpy">دارای ین ژاپن (مثل USDJPY)</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="saveEditCurrency">ذخیره تغییرات</button>
                <button class="btn btn-warning" id="cancelEditCurrency">لغو</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="statsModal">
        <div class="modal-content">
            <h2>آمار و گزارشات معاملاتی</h2>
            <div id="stats-content"></div>
            <div class="modal-actions">
                <button class="btn btn-warning" id="closeStats">بستن</button>
            </div>
        </div>
    </div>
    
    <!-- اعلان خودکار -->
    <div class="auto-alert" id="autoAlert">
        <i class="fas fa-check-circle"></i>
        <span id="alertMessage">عملیات با موفقیت انجام شد</span>
    </div>

    <!-- امضا -->
    <div class="signature">
        طراحی و ساخت توسط ⦙ سعید شیخ احمد صفاری
    </div>

    <script>
        // مدیریت حالت تاریک
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        if (localStorage.getItem('darkMode') === 'enabled') {
            body.classList.add('dark-mode');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i> حالت روشن';
        }

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            
            if (body.classList.contains('dark-mode')) {
                localStorage.setItem('darkMode', 'enabled');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i> حالت روشن';
            } else {
                localStorage.setItem('darkMode', 'disabled');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i> حالت تاریک';
            }
        });

        // مدیریت تب‌ها
        const tabs = document.querySelectorAll('.tab, .mobile-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const hamburgerMenu = document.getElementById('hamburgerMenu');
        const mobileTabs = document.getElementById('mobileTabs');

        let selectedCurrencyHistory = "all";
        let selectedCurrencyCalculator = localStorage.getItem('selectedCurrencyCalculator') || "";

        function switchTab(tabName) {
            tabs.forEach(tab => tab.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            
            const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
            const selectedContent = document.getElementById(tabName);
            
            if (selectedTab && selectedContent) {
                selectedTab.classList.add('active');
                selectedContent.classList.add('active');
            }
            
            mobileTabs.classList.remove('active');
            
            if (tabName === 'history') {
                document.getElementById('filter-currency').value = selectedCurrencyHistory;
                loadHistory();
            }
            
            if (tabName === 'calculator') {
                document.getElementById('currency-pair-calc').value = selectedCurrencyCalculator;
                loadCurrencyPairs();
            }
            
            if (tabName === 'currency-management') {
                loadCategories();
            }
        }

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        hamburgerMenu.addEventListener('click', () => {
            mobileTabs.classList.toggle('active');
        });

        document.addEventListener('click', (e) => {
            if (!hamburgerMenu.contains(e.target) && !mobileTabs.contains(e.target)) {
                mobileTabs.classList.remove('active');
            }
        });

        // مدیریت اعلان خودکار
        function showAlert(message, type = 'success') {
            const alert = document.getElementById('autoAlert');
            const alertMessage = document.getElementById('alertMessage');
            
            alertMessage.textContent = message;
            alert.className = 'auto-alert';
            
            if (type === 'error') alert.classList.add('error');
            else if (type === 'warning') alert.classList.add('warning');
            
            alert.classList.add('show');
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }

        // بارگذاری جفت ارزها در ماشین حساب
        function loadCurrencyPairs() {
            const currencyPairs = document.getElementById('currency-pair-calc');
            const pipCurrency = document.getElementById('pip-currency');
            const filterCurrency = document.getElementById('filter-currency');
            
            currencyPairs.innerHTML = '<option value="">انتخاب جفت ارز</option>';
            pipCurrency.innerHTML = '<option value="">انتخاب جفت ارز</option>';
            filterCurrency.innerHTML = '<option value="all">همه جفت ارزها</option>';
            
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            
            categories.forEach(category => {
                category.currencies.forEach(currency => {
                    const option1 = document.createElement('option');
                    option1.value = currency.name;
                    option1.textContent = currency.name;
                    if (currency.name === selectedCurrencyCalculator) option1.selected = true;
                    currencyPairs.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = currency.name;
                    option2.textContent = currency.name;
                    pipCurrency.appendChild(option2);
                    
                    const option3 = document.createElement('option');
                    option3.value = currency.name;
                    option3.textContent = currency.name;
                    filterCurrency.appendChild(option3);
                });
            });
            
            currencyPairs.addEventListener('change', function() {
                selectedCurrencyCalculator = this.value;
                localStorage.setItem('selectedCurrencyCalculator', selectedCurrencyCalculator);
                updateCurrencyTypeInfo();
            });
            
            pipCurrency.addEventListener('change', updatePipCurrencyInfo);
            
            updateCurrencyTypeInfo();
            updatePipCurrencyInfo();
        }

        function updateCurrencyTypeInfo() {
            const currencyPair = document.getElementById('currency-pair-calc').value;
            const infoElement = document.getElementById('currency-type-info');
            
            if (!currencyPair) {
                infoElement.innerHTML = '';
                return;
            }
            
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            let currencyType = 'standard';
            
            for (const category of categories) {
                const currency = category.currencies.find(c => c.name === currencyPair);
                if (currency) {
                    currencyType = currency.type;
                    break;
                }
            }
            
            if (currencyType === 'jpy') {
                infoElement.innerHTML = '<i class="fas fa-info-circle"></i> این جفت ارز دارای ین ژاپن است (2 رقم اعشار)';
            } else {
                infoElement.innerHTML = '<i class="fas fa-info-circle"></i> این جفت ارز استاندارد است (4 رقم اعشار)';
            }
        }

        function updatePipCurrencyInfo() {
            const currencyPair = document.getElementById('pip-currency').value;
            const infoElement = document.querySelector('.pip-value-info');
            
            if (!currencyPair) return;
            
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            let currencyType = 'standard';
            
            for (const category of categories) {
                const currency = category.currencies.find(c => c.name === currencyPair);
                if (currency) {
                    currencyType = currency.type;
                    break;
                }
            }
            
            if (currencyType === 'jpy') {
                infoElement.innerHTML = '<i class="fas fa-info-circle"></i> این جفت ارز دارای ین ژاپن است (ارزش پیپ: 0.01)';
            } else {
                infoElement.innerHTML = '<i class="fas fa-info-circle"></i> این جفت ارز استاندارد است (ارزش پیپ: 0.0001)';
            }
        }

        // بارگذاری تاریخچه معاملات - اصلاح شده
        function loadHistory() {
            const historyList = document.getElementById('history-list');
            const filterCurrency = document.getElementById('filter-currency').value;
            const filterDate = document.getElementById('filter-date').value;
            const filterResult = document.getElementById('filter-result').value;
            
            selectedCurrencyHistory = filterCurrency;
            
            historyList.innerHTML = '';
            
            const history = JSON.parse(localStorage.getItem('history')) || [];
            
            // فیلتر کردن تاریخچه - اصلاح شده
            let filteredHistory = history;
            
            if (filterCurrency !== 'all') {
                filteredHistory = filteredHistory.filter(item => item.currency === filterCurrency);
            }
            
            // **اصلاح مهم: اگر تاریخ مشخص شده، فقط معاملات آن تاریخ نمایش داده شود**
            if (filterDate) {
                filteredHistory = filteredHistory.filter(item => item.date === filterDate);
            } else {
                // **اگر تاریخ مشخص نشده، هیچ معامله‌ای نمایش داده نشود**
                filteredHistory = [];
            }
            
            if (filterResult !== 'all') {
                if (filterResult === 'profit') {
                    filteredHistory = filteredHistory.filter(item => item.profit > 0);
                } else if (filterResult === 'loss') {
                    filteredHistory = filteredHistory.filter(item => item.profit < 0);
                } else if (filterResult === 'pending') {
                    filteredHistory = filteredHistory.filter(item => !item.profit);
                }
            }
            
            if (filteredHistory.length === 0) {
                let message = 'هیچ معامله‌ای یافت نشد';
                if (filterDate) {
                    message = `هیچ معامله‌ای در تاریخ ${filterDate} یافت نشد`;
                } else {
                    message = 'لطفاً تاریخ مورد نظر را انتخاب کنید';
                }
                
                historyList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>${message}</h3>
                        <p>${!filterDate ? 'برای مشاهده معاملات، ابتدا تاریخ مورد نظر را انتخاب کنید' : 'هیچ معامله‌ای با فیلترهای انتخاب شده مطابقت ندارد'}</p>
                    </div>
                `;
                return;
            }
            
            filteredHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const profitClass = item.profit > 0 ? 'profit' : (item.profit < 0 ? 'loss' : '');
                const profitText = item.profit > 0 ? `+${item.profit}` : (item.profit < 0 ? item.profit : 'در انتظار');
                
                historyItem.innerHTML = `
                    <div class="history-header">
                        <div class="history-currency">${item.currency}</div>
                        <div class="history-date">${item.date}</div>
                    </div>
                    <div class="history-details">
                        <div class="history-detail">
                            <span>حجم معامله:</span>
                            <span>${item.lotSize} لات</span>
                        </div>
                        <div class="history-detail">
                            <span>قیمت ورود:</span>
                            <span>${item.entryPrice}</span>
                        </div>
                        <div class="history-detail">
                            <span>تارگت:</span>
                            <span>${item.takeProfit}</span>
                        </div>
                        <div class="history-detail">
                            <span>استاپ لاس:</span>
                            <span>${item.stopLoss}</span>
                        </div>
                        <div class="history-detail">
                            <span>قیمت خروج:</span>
                            <span>${item.exitPrice || 'ندارد'}</span>
                        </div>
                        <div class="history-detail">
                            <span>نوع پوزیشن:</span>
                            <span>${item.positionType === 'buy' ? 'خرید' : 'فروش'}</span>
                        </div>
                        <div class="history-detail">
                            <span>سود/ضرر:</span>
                            <span class="${profitClass}">${profitText} واحد</span>
                        </div>
                        <div class="history-detail">
                            <span>یادداشت:</span>
                            <span>${item.notes || 'ندارد'}</span>
                        </div>
                    </div>
                    <div class="history-actions">
                        <button class="btn btn-info view-details" data-id="${item.id}">
                            <i class="fas fa-eye"></i> مشاهده جزئیات
                        </button>
                        <button class="btn btn-warning edit-history" data-id="${item.id}">
                            <i class="fas fa-edit"></i> ویرایش
                        </button>
                        <button class="btn btn-danger delete-history" data-id="${item.id}">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
                
                historyList.appendChild(historyItem);
            });
            
            document.querySelectorAll('.edit-history').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    editHistoryItem(id);
                });
            });
            
            document.querySelectorAll('.delete-history').forEach(button => {
                button.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    deleteHistoryItem(id);
                });
            });
        }

        function editHistoryItem(id) {
            const history = JSON.parse(localStorage.getItem('history')) || [];
            const item = history.find(item => item.id == id);
            
            if (!item) return;
            
            document.getElementById('currency-pair-calc').value = item.currency;
            document.getElementById('trade-date').value = item.date;
            document.getElementById('lot-size').value = item.lotSize;
            document.getElementById('entry-price').value = item.entryPrice;
            document.getElementById('take-profit').value = item.takeProfit;
            document.getElementById('stop-loss').value = item.stopLoss;
            document.getElementById('exit-price').value = item.exitPrice || '';
            document.getElementById('position-type').value = item.positionType;
            document.getElementById('trade-notes').value = item.notes || '';
            
            switchTab('calculator');
            
            showAlert('اطلاعات معامله برای ویرایش بارگذاری شد', 'info');
        }

        function deleteHistoryItem(id) {
            if (!confirm('آیا از حذف این معامله اطمینان دارید؟ این عمل قابل بازگشت نیست.')) return;
            
            let history = JSON.parse(localStorage.getItem('history')) || [];
            history = history.filter(item => item.id != id);
            
            localStorage.setItem('history', JSON.stringify(history));
            loadHistory();
            
            showAlert('معامله با موفقیت حذف شد');
        }

        // محاسبه سود/ضرر
        document.getElementById('calculate').addEventListener('click', function() {
            const currencyPair = document.getElementById('currency-pair-calc').value;
            const tradeDate = document.getElementById('trade-date').value;
            const lotSize = parseFloat(document.getElementById('lot-size').value);
            const entryPrice = parseFloat(document.getElementById('entry-price').value);
            const takeProfit = parseFloat(document.getElementById('take-profit').value);
            const stopLoss = parseFloat(document.getElementById('stop-loss').value);
            const exitPrice = document.getElementById('exit-price').value ? parseFloat(document.getElementById('exit-price').value) : null;
            const positionType = document.getElementById('position-type').value;
            const notes = document.getElementById('trade-notes').value;
            
            if (!currencyPair || !tradeDate || !lotSize || !entryPrice || !takeProfit || !stopLoss) {
                showAlert('لطفاً تمام فیلدهای ضروری را پر کنید', 'error');
                return;
            }
            
            let targetPips, stopPips, profit = null;
            
            if (positionType === 'buy') {
                targetPips = (takeProfit - entryPrice) * 10000;
                stopPips = (entryPrice - stopLoss) * 10000;
                
                if (exitPrice) {
                    profit = (exitPrice - entryPrice) * 10000 * lotSize * 10;
                }
            } else {
                targetPips = (entryPrice - takeProfit) * 10000;
                stopPips = (stopLoss - entryPrice) * 10000;
                
                if (exitPrice) {
                    profit = (entryPrice - exitPrice) * 10000 * lotSize * 10;
                }
            }
            
            const riskReward = targetPips / stopPips;
            
            document.getElementById('target-pips').textContent = targetPips.toFixed(2);
            document.getElementById('stop-pips').textContent = stopPips.toFixed(2);
            document.getElementById('risk-reward').textContent = riskReward.toFixed(2);
            document.getElementById('result').style.display = 'block';
            
            const historyItem = {
                id: Date.now(),
                currency: currencyPair,
                date: tradeDate,
                lotSize: lotSize,
                entryPrice: entryPrice,
                takeProfit: takeProfit,
                stopLoss: stopLoss,
                exitPrice: exitPrice,
                positionType: positionType,
                notes: notes,
                profit: profit
            };
            
            let history = JSON.parse(localStorage.getItem('history')) || [];
            history.push(historyItem);
            localStorage.setItem('history', JSON.stringify(history));
            
            showAlert('محاسبه انجام و در تاریخچه ذخیره شد');
        });

        document.getElementById('reset').addEventListener('click', function() {
            document.getElementById('currency-pair-calc').value = '';
            document.getElementById('trade-date').value = '';
            document.getElementById('lot-size').value = '0.1';
            document.getElementById('entry-price').value = '1.1250';
            document.getElementById('take-profit').value = '1.1350';
            document.getElementById('stop-loss').value = '1.1200';
            document.getElementById('exit-price').value = '';
            document.getElementById('position-type').value = 'buy';
            document.getElementById('trade-notes').value = '';
            document.getElementById('result').style.display = 'none';
            
            showAlert('فرم با موفقیت ریست شد', 'info');
        });

        // محاسبه ارزش پیپ
        document.getElementById('calculate-pip-value').addEventListener('click', function() {
            const currencyPair = document.getElementById('pip-currency').value;
            const lotSize = parseFloat(document.getElementById('pip-lot-size').value);
            const price = parseFloat(document.getElementById('pip-price').value);
            const accountCurrency = document.getElementById('account-currency').value;
            
            if (!currencyPair || !lotSize || !price) {
                showAlert('لطفاً تمام فیلدهای ضروری را پر کنید', 'error');
                return;
            }
            
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            let currencyType = 'standard';
            
            for (const category of categories) {
                const currency = category.currencies.find(c => c.name === currencyPair);
                if (currency) {
                    currencyType = currency.type;
                    break;
                }
            }
            
            let pipValue;
            
            if (currencyType === 'jpy') {
                pipValue = (0.01 / price) * lotSize * 100000;
            } else {
                pipValue = 0.0001 * lotSize * 100000;
            }
            
            document.getElementById('calculated-pip-value').textContent = pipValue.toFixed(2);
            document.getElementById('calculated-10pip-value').textContent = (pipValue * 10).toFixed(2);
            document.getElementById('calculated-50pip-value').textContent = (pipValue * 50).toFixed(2);
            
            document.getElementById('pip-currency-display').textContent = accountCurrency;
            document.getElementById('pip10-currency-display').textContent = accountCurrency;
            document.getElementById('pip50-currency-display').textContent = accountCurrency;
            
            document.getElementById('pip-result').style.display = 'block';
        });

        document.getElementById('reset-pip-calculator').addEventListener('click', function() {
            document.getElementById('pip-lot-size').value = '0.1';
            document.getElementById('pip-price').value = '1.1250';
            document.getElementById('account-currency').value = 'USD';
            document.getElementById('pip-result').style.display = 'none';
            
            showAlert('ماشین حساب ارزش پیپ ریست شد', 'info');
        });

        document.querySelectorAll('.quick-lot-btn').forEach(button => {
            button.addEventListener('click', function() {
                const lotSize = this.getAttribute('data-lot');
                document.getElementById('pip-lot-size').value = lotSize;
            });
        });

        document.getElementById('apply-filter').addEventListener('click', loadHistory);

        document.getElementById('clear-filter').addEventListener('click', function() {
            document.getElementById('filter-currency').value = 'all';
            document.getElementById('filter-date').value = '';
            document.getElementById('filter-result').value = 'all';
            loadHistory();
            
            showAlert('فیلترها حذف شدند', 'info');
        });

        // بارگذاری اولیه
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrencyPairs();
            loadHistory();
            loadCategories();
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('trade-date').value = today;
            
            switchTab('calculator');
        });

        // بارگذاری دسته‌بندی‌ها
        function loadCategories() {
            const categoriesContainer = document.getElementById('categories-management');
            const currencyCategorySelect = document.getElementById('currency-category');
            const editCurrencyCategorySelect = document.getElementById('edit-currency-category');
            
            categoriesContainer.innerHTML = '';
            currencyCategorySelect.innerHTML = '';
            editCurrencyCategorySelect.innerHTML = '';
            
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            
            if (categories.length === 0) {
                categoriesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>هیچ دسته‌بندی وجود ندارد</h3>
                        <p>برای شروع، یک دسته‌بندی جدید ایجاد کنید.</p>
                    </div>
                `;
                return;
            }
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                currencyCategorySelect.appendChild(option);
                
                const editOption = document.createElement('option');
                editOption.value = category.id;
                editOption.textContent = category.name;
                editCurrencyCategorySelect.appendChild(editOption);
                
                const categoryElement = document.createElement('div');
                categoryElement.className = 'currency-category';
                categoryElement.setAttribute('data-category-id', category.id);
                
                let currenciesHTML = '';
                
                if (category.currencies.length === 0) {
                    currenciesHTML = `
                        <div class="empty-state">
                            <i class="fas fa-money-bill-wave"></i>
                            <p>هیچ جفت ارزی در این دسته وجود ندارد</p>
                        </div>
                    `;
                } else {
                    category.currencies.forEach(currency => {
                        const currencyTypeBadge = currency.type === 'jpy' ? 
                            '<span class="currency-type-badge">JPY</span>' : 
                            '<span class="currency-type-badge">STD</span>';
                        
                        currenciesHTML += `
                            <div class="currency-card" draggable="true" data-currency-id="${currency.id}">
                                <div class="currency-name">
                                    ${currencyTypeBadge} ${currency.name}
                                </div>
                                <div class="currency-actions">
                                    <button class="currency-action-btn edit-currency" data-currency-id="${currency.id}">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="currency-action-btn delete-currency" data-currency-id="${currency.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                    <button class="currency-action-btn move-btn">
                                        <i class="fas fa-arrows-alt"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                }
                
                categoryElement.innerHTML = `
                    <div class="category-header">
                        <div class="category-title">
                            <i class="fas fa-chevron-down"></i>
                            ${category.name}
                            <span class="info-badge">${category.currencies.length} جفت ارز</span>
                        </div>
                        <div class="category-actions">
                            <button class="category-action-btn edit-btn edit-category" data-category-id="${category.id}">
                                <i class="fas fa-edit"></i> ویرایش
                            </button>
                            <button class="category-action-btn delete-btn delete-category" data-category-id="${category.id}">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                    </div>
                    <div class="currency-list" data-category-id="${category.id}">
                        ${currenciesHTML}
                    </div>
                `;
                
                categoriesContainer.appendChild(categoryElement);
            });
            
            setupDragAndDrop();
            
            document.querySelectorAll('.edit-category').forEach(button => {
                button.addEventListener('click', function() {
                    const categoryId = this.getAttribute('data-category-id');
                    editCategory(categoryId);
                });
            });
            
            document.querySelectorAll('.delete-category').forEach(button => {
                button.addEventListener('click', function() {
                    const categoryId = this.getAttribute('data-category-id');
                    deleteCategory(categoryId);
                });
            });
            
            document.querySelectorAll('.edit-currency').forEach(button => {
                button.addEventListener('click', function() {
                    const currencyId = this.getAttribute('data-currency-id');
                    editCurrency(currencyId);
                });
            });
            
            document.querySelectorAll('.delete-currency').forEach(button => {
                button.addEventListener('click', function() {
                    const currencyId = this.getAttribute('data-currency-id');
                    deleteCurrency(currencyId);
                });
            });
            
            document.querySelectorAll('.category-header').forEach(header => {
                header.addEventListener('click', function() {
                    const categoryId = this.querySelector('.edit-category').getAttribute('data-category-id');
                    const currencyList = document.querySelector(`.currency-list[data-category-id="${categoryId}"]`);
                    const categoryTitle = this.querySelector('.category-title');
                    
                    currencyList.classList.toggle('collapsed');
                    categoryTitle.classList.toggle('collapsed');
                });
            });
        }

        function setupDragAndDrop() {
            const currencyCards = document.querySelectorAll('.currency-card');
            const currencyLists = document.querySelectorAll('.currency-list');
            
            let draggedItem = null;
            let sourceCategory = null;
            
            currencyCards.forEach(card => {
                card.addEventListener('dragstart', function(e) {
                    draggedItem = this;
                    sourceCategory = this.closest('.currency-list').getAttribute('data-category-id');
                    setTimeout(() => this.classList.add('dragging'), 0);
                });
                
                card.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    draggedItem = null;
                    sourceCategory = null;
                    saveCategoryChanges();
                });
            });
            
            currencyLists.forEach(list => {
                list.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });
                
                list.addEventListener('dragleave', function() {
                    this.classList.remove('drag-over');
                });
                
                list.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    
                    if (draggedItem && this !== draggedItem.parentNode) {
                        const targetCategory = this.getAttribute('data-category-id');
                        moveCurrency(draggedItem.getAttribute('data-currency-id'), sourceCategory, targetCategory);
                        this.appendChild(draggedItem);
                    }
                });
            });
        }

        function moveCurrency(currencyId, sourceCategoryId, targetCategoryId) {
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            const sourceCategory = categories.find(c => c.id == sourceCategoryId);
            const targetCategory = categories.find(c => c.id == targetCategoryId);
            
            if (!sourceCategory || !targetCategory) return;
            
            const currencyIndex = sourceCategory.currencies.findIndex(c => c.id == currencyId);
            if (currencyIndex === -1) return;
            
            const currency = sourceCategory.currencies[currencyIndex];
            sourceCategory.currencies.splice(currencyIndex, 1);
            targetCategory.currencies.push(currency);
            
            localStorage.setItem('categories', JSON.stringify(categories));
            showAlert(`جفت ارز ${currency.name} به دسته‌بندی ${targetCategory.name} منتقل شد`);
        }

        function saveCategoryChanges() {
            const categoriesContainer = document.getElementById('categories-management');
            const categories = [];
            
            const categoryElements = categoriesContainer.querySelectorAll('.currency-category');
            
            categoryElements.forEach(categoryElement => {
                const categoryId = categoryElement.getAttribute('data-category-id');
                const categoryName = categoryElement.querySelector('.category-title').textContent.replace(/[\d\s]+جفت ارز/, '').trim();
                
                const currencies = [];
                const currencyElements = categoryElement.querySelectorAll('.currency-card');
                
                currencyElements.forEach(currencyElement => {
                    const currencyId = currencyElement.getAttribute('data-currency-id');
                    const currencyName = currencyElement.querySelector('.currency-name').textContent.trim();
                    
                    let currencyType = 'standard';
                    if (currencyName.includes('JPY')) currencyType = 'jpy';
                    
                    const cleanName = currencyName.replace('JPY', '').replace('STD', '').trim();
                    
                    currencies.push({
                        id: parseInt(currencyId),
                        name: cleanName,
                        type: currencyType
                    });
                });
                
                categories.push({
                    id: parseInt(categoryId),
                    name: categoryName,
                    currencies: currencies
                });
            });
            
            localStorage.setItem('categories', JSON.stringify(categories));
            loadCurrencyPairs();
            showAlert('تغییرات دسته‌بندی‌ها ذخیره شد');
        }

        document.getElementById('add-category').addEventListener('click', function() {
            document.getElementById('categoryModalTitle').textContent = 'افزودن دسته جدید';
            document.getElementById('category-name').value = '';
            document.getElementById('categoryModal').style.display = 'flex';
        });

        document.getElementById('saveCategory').addEventListener('click', function() {
            const categoryName = document.getElementById('category-name').value.trim();
            
            if (!categoryName) {
                showAlert('لطفاً نام دسته را وارد کنید', 'error');
                return;
            }
            
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            const newCategory = {
                id: Date.now(),
                name: categoryName,
                currencies: []
            };
            
            categories.push(newCategory);
            localStorage.setItem('categories', JSON.stringify(categories));
            
            document.getElementById('categoryModal').style.display = 'none';
            loadCategories();
            
            showAlert('دسته جدید با موفقیت ایجاد شد');
        });

        document.getElementById('cancelCategory').addEventListener('click', function() {
            document.getElementById('categoryModal').style.display = 'none';
        });

        function editCategory(categoryId) {
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            const category = categories.find(c => c.id == categoryId);
            
            if (!category) return;
            
            document.getElementById('categoryModalTitle').textContent = 'ویرایش دسته';
            document.getElementById('category-name').value = category.name;
            document.getElementById('categoryModal').style.display = 'flex';
            
            const saveButton = document.getElementById('saveCategory');
            const originalHandler = saveButton.onclick;
            
            saveButton.onclick = function() {
                const categoryName = document.getElementById('category-name').value.trim();
                
                if (!categoryName) {
                    showAlert('لطفاً نام دسته را وارد کنید', 'error');
                    return;
                }
                
                category.name = categoryName;
                localStorage.setItem('categories', JSON.stringify(categories));
                
                document.getElementById('categoryModal').style.display = 'none';
                loadCategories();
                
                showAlert('دسته با موفقیت ویرایش شد');
                saveButton.onclick = originalHandler;
            };
        }

        function deleteCategory(categoryId) {
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            const category = categories.find(c => c.id == categoryId);
            
            if (!category) return;
            
            if (category.currencies.length > 0) {
                document.getElementById('delete-category-message').textContent = 
                    `دسته‌بندی "${category.name}" دارای ${category.currencies.length} جفت ارز است. می‌خواهید چه عملی انجام دهید؟`;
                
                const moveSection = document.getElementById('move-currencies-section');
                moveSection.style.display = 'block';
                
                const moveToSelect = document.getElementById('move-to-category');
                moveToSelect.innerHTML = '';
                
                categories.forEach(cat => {
                    if (cat.id != categoryId) {
                        const option = document.createElement('option');
                        option.value = cat.id;
                        option.textContent = cat.name;
                        moveToSelect.appendChild(option);
                    }
                });
                
                const deleteOption = document.createElement('option');
                deleteOption.value = 'delete';
                deleteOption.textContent = 'حذف همه جفت ارزها';
                moveToSelect.appendChild(deleteOption);
                
                document.getElementById('deleteCategoryModal').style.display = 'flex';
                
                document.getElementById('confirmDeleteCategory').onclick = function() {
                    const action = moveToSelect.value;
                    
                    if (action === 'delete') {
                        categories.splice(categories.indexOf(category), 1);
                    } else {
                        const targetCategory = categories.find(c => c.id == action);
                        if (targetCategory) {
                            targetCategory.currencies = targetCategory.currencies.concat(category.currencies);
                            categories.splice(categories.indexOf(category), 1);
                        }
                    }
                    
                    localStorage.setItem('categories', JSON.stringify(categories));
                    document.getElementById('deleteCategoryModal').style.display = 'none';
                    loadCategories();
                    loadCurrencyPairs();
                    
                    showAlert('دسته‌بندی با موفقیت حذف شد');
                };
            } else {
                if (confirm(`آیا از حذف دسته‌بندی "${category.name}" اطمینان دارید؟`)) {
                    categories.splice(categories.indexOf(category), 1);
                    localStorage.setItem('categories', JSON.stringify(categories));
                    loadCategories();
                    
                    showAlert('دسته‌بندی با موفقیت حذف شد');
                }
            }
        }

        document.getElementById('cancelDeleteCategory').addEventListener('click', function() {
            document.getElementById('deleteCategoryModal').style.display = 'none';
        });

        document.getElementById('add-currency').addEventListener('click', function() {
            document.getElementById('currencyModalTitle').textContent = 'افزودن جفت ارز جدید';
            document.getElementById('currency-name').value = '';
            document.getElementById('currency-type').value = 'standard';
            document.getElementById('currencyModal').style.display = 'flex';
        });

        document.getElementById('saveCurrency').addEventListener('click', function() {
            const currencyName = document.getElementById('currency-name').value.trim().toUpperCase();
            const categoryId = document.getElementById('currency-category').value;
            const currencyType = document.getElementById('currency-type').value;
            
            if (!currencyName) {
                showAlert('لطفاً نام جفت ارز را وارد کنید', 'error');
                return;
            }
            
            if (!categoryId) {
                showAlert('لطفاً یک دسته‌بندی انتخاب کنید', 'error');
                return;
            }
            
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            const category = categories.find(c => c.id == categoryId);
            
            if (!category) {
                showAlert('دسته‌بندی انتخاب شده معتبر نیست', 'error');
                return;
            }
            
            const existingCurrency = category.currencies.find(c => c.name === currencyName);
            if (existingCurrency) {
                showAlert('این جفت ارز قبلاً در این دسته اضافه شده است', 'error');
                return;
            }
            
            const newCurrency = {
                id: Date.now(),
                name: currencyName,
                type: currencyType
            };
            
            category.currencies.push(newCurrency);
            localStorage.setItem('categories', JSON.stringify(categories));
            
            document.getElementById('currencyModal').style.display = 'none';
            loadCategories();
            loadCurrencyPairs();
            
            showAlert('جفت ارز جدید با موفقیت اضافه شد');
        });

        document.getElementById('cancelCurrency').addEventListener('click', function() {
            document.getElementById('currencyModal').style.display = 'none';
        });

        function editCurrency(currencyId) {
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            let currency = null;
            let category = null;
            
            for (const cat of categories) {
                currency = cat.currencies.find(c => c.id == currencyId);
                if (currency) {
                    category = cat;
                    break;
                }
            }
            
            if (!currency || !category) return;
            
            document.getElementById('edit-currency-name').value = currency.name;
            document.getElementById('edit-currency-type').value = currency.type;
            document.getElementById('edit-currency-category').value = category.id;
            document.getElementById('editCurrencyModal').style.display = 'flex';
            
            document.getElementById('saveEditCurrency').onclick = function() {
                const currencyName = document.getElementById('edit-currency-name').value.trim().toUpperCase();
                const newCategoryId = document.getElementById('edit-currency-category').value;
                const currencyType = document.getElementById('edit-currency-type').value;
                
                if (!currencyName) {
                    showAlert('لطفاً نام جفت ارز را وارد کنید', 'error');
                    return;
                }
                
                if (!newCategoryId) {
                    showAlert('لطفاً یک دسته‌بندی انتخاب کنید', 'error');
                    return;
                }
                
                const newCategory = categories.find(c => c.id == newCategoryId);
                if (!newCategory) {
                    showAlert('دسته‌بندی انتخاب شده معتبر نیست', 'error');
                    return;
                }
                
                if (category.id != newCategoryId) {
                    category.currencies = category.currencies.filter(c => c.id != currencyId);
                    newCategory.currencies.push({
                        id: parseInt(currencyId),
                        name: currencyName,
                        type: currencyType
                    });
                } else {
                    currency.name = currencyName;
                    currency.type = currencyType;
                }
                
                localStorage.setItem('categories', JSON.stringify(categories));
                
                document.getElementById('editCurrencyModal').style.display = 'none';
                loadCategories();
                loadCurrencyPairs();
                
                showAlert('جفت ارز با موفقیت ویرایش شد');
            };
        }

        document.getElementById('cancelEditCurrency').addEventListener('click', function() {
            document.getElementById('editCurrencyModal').style.display = 'none';
        });

        function deleteCurrency(currencyId) {
            if (!confirm('آیا از حذف این جفت ارز اطمینان دارید؟')) return;
            
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            
            for (const category of categories) {
                const currencyIndex = category.currencies.findIndex(c => c.id == currencyId);
                if (currencyIndex !== -1) {
                    category.currencies.splice(currencyIndex, 1);
                    break;
                }
            }
            
            localStorage.setItem('categories', JSON.stringify(categories));
            loadCategories();
            loadCurrencyPairs();
            
            showAlert('جفت ارز با موفقیت حذف شد');
        }

        document.getElementById('save-changes').addEventListener('click', saveCategoryChanges);

        document.getElementById('delete-history').addEventListener('click', function() {
            if (!confirm('آیا از حذف تمام تاریخچه معاملات اطمینان دارید؟ این عمل قابل بازگشت نیست.')) return;
            
            localStorage.removeItem('history');
            loadHistory();
            
            showAlert('تاریخچه معاملات با موفقیت حذف شد');
        });

        document.getElementById('delete-currencies').addEventListener('click', function() {
            if (!confirm('آیا از حذف تمام جفت ارزها و دسته‌بندی‌ها اطمینان دارید؟ این عمل قابل بازگشت نیست.')) return;
            
            localStorage.removeItem('categories');
            loadCategories();
            loadCurrencyPairs();
            
            showAlert('جفت ارزها و دسته‌بندی‌ها با موفقیت حذف شد');
        });

        document.getElementById('delete-all').addEventListener('click', function() {
            if (!confirm('آیا از حذف تمام داده‌های سیستم اطمینان دارید؟ این عمل قابل بازگشت نیست.')) return;
            
            localStorage.clear();
            loadCategories();
            loadCurrencyPairs();
            loadHistory();
            
            showAlert('تمام داده‌های سیستم با موفقیت حذف شد');
        });

        document.getElementById('backup-data').addEventListener('click', function() {
            const data = {
                categories: JSON.parse(localStorage.getItem('categories')) || [],
                history: JSON.parse(localStorage.getItem('history')) || [],
                settings: {
                    darkMode: localStorage.getItem('darkMode') || 'disabled',
                    selectedCurrencyCalculator: selectedCurrencyCalculator
                }
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `forex-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('فایل پشتیبان با موفقیت دانلود شد');
        });

        document.getElementById('restore-data').addEventListener('click', function() {
            const fileInput = document.getElementById('backup-file');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('لطفاً یک فایل پشتیبان انتخاب کنید', 'error');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.categories) localStorage.setItem('categories', JSON.stringify(data.categories));
                    if (data.history) localStorage.setItem('history', JSON.stringify(data.history));
                    
                    if (data.settings) {
                        if (data.settings.darkMode) {
                            localStorage.setItem('darkMode', data.settings.darkMode);
                            
                            if (data.settings.darkMode === 'enabled') {
                                body.classList.add('dark-mode');
                                themeToggle.innerHTML = '<i class="fas fa-sun"></i> حالت روشن';
                            } else {
                                body.classList.remove('dark-mode');
                                themeToggle.innerHTML = '<i class="fas fa-moon"></i> حالت تاریک';
                            }
                        }
                        
                        if (data.settings.selectedCurrencyCalculator) {
                            selectedCurrencyCalculator = data.settings.selectedCurrencyCalculator;
                            localStorage.setItem('selectedCurrencyCalculator', selectedCurrencyCalculator);
                        }
                    }
                    
                    loadCategories();
                    loadCurrencyPairs();
                    loadHistory();
                    
                    showAlert('داده‌ها با موفقیت بازیابی شدند');
                    fileInput.value = '';
                } catch (error) {
                    showAlert('خطا در خواندن فایل پشتیبان', 'error');
                    console.error(error);
                }
            };
            
            reader.readAsText(file);
        });

        document.getElementById('show-stats').addEventListener('click', function() {
            const history = JSON.parse(localStorage.getItem('history')) || [];
            const categories = JSON.parse(localStorage.getItem('categories')) || [];
            
            let totalTrades = history.length;
            let profitableTrades = history.filter(t => t.profit > 0).length;
            let losingTrades = history.filter(t => t.profit < 0).length;
            let pendingTrades = history.filter(t => !t.profit).length;
            
            let totalProfit = history.reduce((sum, trade) => sum + (trade.profit || 0), 0);
            let averageProfit = totalTrades > 0 ? totalProfit / totalTrades : 0;
            
            let winRate = totalTrades > 0 ? (profitableTrades / totalTrades) * 100 : 0;
            
            const statsContent = document.getElementById('stats-content');
            statsContent.innerHTML = `
                <div class="result">
                    <div class="result-item">
                        <span>تعداد کل معاملات:</span>
                        <span>${totalTrades}</span>
                    </div>
                    <div class="result-item">
                        <span>معاملات سودده:</span>
                        <span>${profitableTrades}</span>
                    </div>
                    <div class="result-item">
                        <span>معاملات ضررده:</span>
                        <span>${losingTrades}</span>
                    </div>
                    <div class="result-item">
                        <span>معاملات در انتظار:</span>
                        <span>${pendingTrades}</span>
                    </div>
                    <div class="result-item">
                        <span>نرخ برد:</span>
                        <span>${winRate.toFixed(2)}%</span>
                    </div>
                    <div class="result-item">
                        <span>سود/ضرر کل:</span>
                        <span class="${totalProfit >= 0 ? 'profit' : 'loss'}">${totalProfit.toFixed(2)} واحد</span>
                    </div>
                    <div class="result-item">
                        <span>سود/ضرر متوسط:</span>
                        <span class="${averageProfit >= 0 ? 'profit' : 'loss'}">${averageProfit.toFixed(2)} واحد</span>
                    </div>
                    <div class="result-item">
                        <span>تعداد جفت ارزها:</span>
                        <span>${categories.reduce((sum, cat) => sum + cat.currencies.length, 0)}</span>
                    </div>
                </div>
            `;
            
            document.getElementById('statsModal').style.display = 'flex';
        });

        document.getElementById('closeStats').addEventListener('click', function() {
            document.getElementById('statsModal').style.display = 'none';
        });

        window.addEventListener('click', function(e) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (e.target === modal) modal.style.display = 'none';
            });
        });
    </script>
</body>
</html>
